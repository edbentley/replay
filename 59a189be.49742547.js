(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{136:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(166),o=n(160),s=n(165),u=50,c=40,l=Object(o.a)({render:function(){return[o.b.image({fileName:"/img/bird.png",width:u,height:c})]}}),d=40,p=Object(o.a)({render:function(e){var t=e.props,n=f(e.device.size,t.pipe.gapY),r=n.yUpperTop,i=n.yUpperBottom,a=n.yLowerTop,s=n.yLowerBottom;return[o.b.rectangle({color:"green",width:d,height:r-i,y:(r+i)/2}),o.b.rectangle({color:"green",width:d,height:a-s,y:(a+s)/2})]}});function f(e,t){return{yUpperTop:e.height/2+e.heightMargin,yUpperBottom:t+85,yLowerTop:t-85,yLowerBottom:-e.height/2-e.heightMargin}}var h=Object(o.a)({init:function(e){var t=e.device;return{birdY:10,birdGravity:-12,pipes:e.props.paused?[]:[v(t)],score:0}},loop:function(e){var t=e.props,n=e.state,r=e.getInputs,i=e.device;if(t.paused)return n;var a=r(),o=n.birdGravity,u=n.birdY,c=n.pipes,l=n.score;return u-=o+=.8,(a.pointer.justPressed||a.keysJustPressed[" "])&&(o=-12),c[c.length-1].x<140&&(c=[].concat(c,[v(i)]).filter((function(e){return e.x>-(i.size.width+i.size.widthMargin+d)}))),function(e,t,n){if(e-20<-(t.height/2+t.heightMargin)||e+20>t.height/2+t.heightMargin)return!0;for(var r,i=function(){var n=r.value;if(n.x>45||n.x<-45)return"continue";var i=f(t,n.gapY),a=i.yUpperTop,o=i.yUpperBottom,s=i.yLowerTop,u=i.yLowerBottom,c={x:n.x,y:(a+o)/2,width:d,height:a-o},l={x:n.x,y:(s+u)/2,width:d,height:s-u};return[{x:25,y:e+20},{x:25,y:e-20},{x:0,y:e+20},{x:0,y:e-20},{x:-25,y:e+20},{x:-25,y:e-20}].some((function(e){return m(e,c)||m(e,l)}))?{v:!0}:void 0},a=Object(s.a)(n);!(r=a()).done;){var o=i();if("continue"!==o&&"object"==typeof o)return o.v}return!1}(u,i.size,c)&&(i.audio("/audio/boop.wav").play(),t.gameOver(n.score)),{birdGravity:o,birdY:u,pipes:c=c.map((function(e){var t=e.passed;return!t&&e.x<-45&&(t=!0,l++),Object.assign({},e,{passed:t,x:e.x-2})})),score:l}},render:function(e){var t=e.state,n=e.device,r=n.size;return[o.b.rectangle({color:"#add8e6",width:r.width+2*r.widthMargin,height:r.height+2*r.heightMargin}),l({id:"bird",x:0,y:t.birdY,rotation:Math.max(-30,3*t.birdGravity-30)})].concat(t.pipes.map((function(e,t){return p({id:"pipe-"+t,pipe:e,x:e.x})})),[o.b.text({text:"Score: "+t.score,color:"white",x:-n.size.width/2+10,y:n.size.height/2+n.size.heightMargin-80,font:{align:"left"}})])}});function v(e){var t=(e.size.height+2*e.size.heightMargin-340)*(e.random()-.5);return{x:e.size.width+e.size.widthMargin+50,gapY:t,passed:!1}}function m(e,t){return e.x>t.x-t.width/2&&e.x<t.x+t.width/2&&e.y>t.y-t.height/2&&e.y<t.y+t.height/2}var g=Object(o.a)({render:function(e){var t=e.props,n=e.getInputs,r=e.device,i=n();return(i.pointer.justReleased||i.keysJustPressed[" "])&&t.start(),[o.b.text({text:r.isTouchScreen?"Tap to Start":"Click or Space Bar to Start",color:"white",y:100}),o.b.text({text:"High score: "+t.highScore,font:{family:"Courier",size:24},color:"white",y:150})]}}),y=Object(o.a)({init:function(e){var t=e.device,n=e.preloadFiles,r=e.updateState;return Promise.all([t.storage.getItem("highScore"),n({imageFileNames:["/img/bird.png"],audioFileNames:["/audio/boop.wav"]})]).then((function(e){var t=e[0];r((function(e){return Object.assign({},e,{view:"menu",highScore:Number(t||"0")})}))})),{view:"loading",attempt:0,highScore:0}},render:function(e){var t=e.state,n=e.updateState,r=e.device;if("loading"===t.view)return[o.b.text({color:"black",text:"Loading..."})];var i="menu"===t.view;return[h({id:"level-"+t.attempt,paused:i,gameOver:function(e){n((function(t){var n=t.highScore;return e>n&&(n=e,r.storage.setItem("highScore",String(n))),Object.assign({},t,{view:"menu",highScore:n})}))}}),i?g({id:"menu",highScore:t.highScore,start:function(){n((function(e){return Object.assign({},e,{view:"level",attempt:e.attempt+1})}))}}):null]}}),b={id:"Game",size:{width:400,height:600,maxHeightMargin:150},defaultFont:{family:"Helvetica",size:24}},x=n(71);t.default=function(){return i.a.createElement(a.a,{part:19,MDXContent:x.default,codesTs:[{file:"level.ts",code:'import { makeSprite, t, Device, DeviceSize } from "@replay/core";\nimport { WebInputs } from "@replay/web";\nimport { iOSInputs } from "@replay/swift";\nimport { Bird, birdWidth, birdHeight } from "./bird";\nimport { Pipe, PipeT, pipeWidth, pipeGap, getPipeYPositions } from "./pipe";\n\nconst speedX = 2;\nconst birdX = 0;\n\ntype LevelProps = {\n  paused: boolean;\n  gameOver: (score: number) => void;\n};\n\ntype LevelState = {\n  birdY: number;\n  birdGravity: number;\n  pipes: PipeT[];\n  score: number;\n};\n\nexport const Level = makeSprite<LevelProps, LevelState, WebInputs | iOSInputs>({\n  init({ device, props }) {\n    return {\n      birdY: 10,\n      birdGravity: -12,\n      pipes: props.paused ? [] : [newPipe(device)],\n      score: 0,\n    };\n  },\n\n  loop({ props, state, getInputs, device }) {\n    if (props.paused) {\n      return state;\n    }\n\n    const inputs = getInputs();\n\n    let { birdGravity, birdY, pipes, score } = state;\n\n    birdGravity += 0.8;\n    birdY -= birdGravity;\n\n    if (inputs.pointer.justPressed || inputs.keysJustPressed[" "]) {\n      birdGravity = -12;\n    }\n\n    const lastPipe = pipes[pipes.length - 1];\n    if (lastPipe.x < 140) {\n      pipes = [...pipes, newPipe(device)]\n        // Remove the pipes off screen on left\n        .filter(\n          (pipe) =>\n            pipe.x > -(device.size.width + device.size.widthMargin + pipeWidth)\n        );\n    }\n\n    if (didHitPipe(birdY, device.size, pipes)) {\n      device.audio("/audio/boop.wav").play();\n      props.gameOver(state.score);\n    }\n\n    // Move pipes to the left\n    pipes = pipes.map((pipe) => {\n      let passed = pipe.passed;\n      if (!passed && pipe.x < birdX - birdWidth / 2 - pipeWidth / 2) {\n        // Mark pipe as having passed bird\'s x position\n        passed = true;\n        score++;\n      }\n      return { ...pipe, passed, x: pipe.x - speedX };\n    });\n\n    return {\n      birdGravity,\n      birdY,\n      pipes,\n      score,\n    };\n  },\n\n  render({ state, device }) {\n    const { size } = device;\n    return [\n      t.rectangle({\n        color: "#add8e6",\n        width: size.width + size.widthMargin * 2,\n        height: size.height + size.heightMargin * 2,\n      }),\n      Bird({\n        id: "bird",\n        x: birdX,\n        y: state.birdY,\n        rotation: Math.max(-30, state.birdGravity * 3 - 30),\n      }),\n      ...state.pipes.map((pipe, index) =>\n        Pipe({\n          id: `pipe-${index}`,\n          pipe,\n          x: pipe.x,\n        })\n      ),\n      t.text({\n        text: `Score: ${state.score}`,\n        color: "white",\n        x: -device.size.width / 2 + 10,\n        y: device.size.height / 2 + device.size.heightMargin - 80,\n        font: {\n          align: "left",\n        },\n      }),\n    ];\n  },\n});\n\nfunction newPipe(device: Device): PipeT {\n  const height = device.size.height + device.size.heightMargin * 2;\n  const randomY = (height - pipeGap * 2) * (device.random() - 0.5);\n\n  return {\n    x: device.size.width + device.size.widthMargin + 50,\n    gapY: randomY,\n    passed: false,\n  };\n}\n\nfunction didHitPipe(birdY: number, size: DeviceSize, pipes: PipeT[]) {\n  if (\n    birdY - birdHeight / 2 < -(size.height / 2 + size.heightMargin) ||\n    birdY + birdHeight / 2 > size.height / 2 + size.heightMargin\n  ) {\n    // hit bottom or top\n    return true;\n  }\n  for (const pipe of pipes) {\n    if (\n      pipe.x > birdX + birdWidth / 2 + pipeWidth / 2 ||\n      pipe.x < birdX - birdWidth / 2 - pipeWidth / 2\n    ) {\n      // bird isn\'t at pipe\n      continue;\n    }\n    const {\n      yUpperTop,\n      yUpperBottom,\n      yLowerTop,\n      yLowerBottom,\n    } = getPipeYPositions(size, pipe.gapY);\n    const topPipeRect = {\n      x: pipe.x,\n      y: (yUpperTop + yUpperBottom) / 2,\n      width: pipeWidth,\n      height: yUpperTop - yUpperBottom,\n    };\n    const bottomPipeRect = {\n      x: pipe.x,\n      y: (yLowerTop + yLowerBottom) / 2,\n      width: pipeWidth,\n      height: yLowerTop - yLowerBottom,\n    };\n    // Check a few points at edges of bird\n    const birdPoints = [\n      { x: birdX + birdWidth / 2, y: birdY + birdHeight / 2 },\n      { x: birdX + birdWidth / 2, y: birdY - birdHeight / 2 },\n      { x: birdX, y: birdY + birdHeight / 2 },\n      { x: birdX, y: birdY - birdHeight / 2 },\n      { x: birdX - birdWidth / 2, y: birdY + birdHeight / 2 },\n      { x: birdX - birdWidth / 2, y: birdY - birdHeight / 2 },\n    ];\n    if (\n      birdPoints.some(\n        (point) =>\n          pointInRect(point, topPipeRect) || pointInRect(point, bottomPipeRect)\n      )\n    ) {\n      // Bird hit a pipe!\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction pointInRect(\n  point: { x: number; y: number },\n  rect: { x: number; y: number; height: number; width: number }\n) {\n  return (\n    point.x > rect.x - rect.width / 2 &&\n    point.x < rect.x + rect.width / 2 &&\n    point.y > rect.y - rect.height / 2 &&\n    point.y < rect.y + rect.height / 2\n  );\n}\n',highlight:[59]},{file:"index.ts",code:'import { makeSprite, GameProps, t } from "@replay/core";\nimport { Level } from "./level";\nimport { Menu } from "./menu";\n\ntype GameState = {\n  view: "loading" | "menu" | "level";\n  attempt: number;\n  highScore: number;\n};\n\nexport const Game = makeSprite<GameProps, GameState>({\n  init({ device, preloadFiles, updateState }) {\n    Promise.all([\n      device.storage.getItem("highScore"),\n      preloadFiles({\n        imageFileNames: ["bird.png"],\n        audioFileNames: ["boop.wav"],\n      }),\n    ]).then(([highScore]) => {\n      updateState((state) => {\n        return {\n          ...state,\n          view: "menu",\n          highScore: Number(highScore || "0"),\n        };\n      });\n    });\n\n    return {\n      view: "loading",\n      attempt: 0,\n      highScore: 0,\n    };\n  },\n\n  render({ state, updateState, device }) {\n    if (state.view === "loading") {\n      return [\n        t.text({\n          color: "black",\n          text: "Loading...",\n        }),\n      ];\n    }\n\n    const inMenuScreen = state.view === "menu";\n\n    return [\n      Level({\n        id: `level-${state.attempt}`,\n        paused: inMenuScreen,\n        gameOver: (score) => {\n          updateState((prevState) => {\n            let { highScore } = prevState;\n            if (score > highScore) {\n              highScore = score;\n              device.storage.setItem("highScore", String(highScore));\n            }\n            return {\n              ...prevState,\n              view: "menu",\n              highScore,\n            };\n          });\n        },\n      }),\n      inMenuScreen\n        ? Menu({\n            id: "menu",\n            highScore: state.highScore,\n            start: () => {\n              updateState((prevState) => {\n                return {\n                  ...prevState,\n                  view: "level",\n                  attempt: prevState.attempt + 1,\n                };\n              });\n            },\n          })\n        : null,\n    ];\n  },\n});\n\nexport const gameProps: GameProps = {\n  id: "Game",\n  size: {\n    width: 400,\n    height: 600,\n    maxHeightMargin: 150,\n  },\n  defaultFont: {\n    family: "Helvetica",\n    size: 24,\n  },\n};\n',highlight:[17]}],codesJs:[{file:"level.js",code:'import { makeSprite, t } from "@replay/core";\nimport { Bird, birdWidth, birdHeight } from "./bird";\nimport { Pipe, pipeWidth, pipeGap, getPipeYPositions } from "./pipe";\n\nconst speedX = 2;\nconst birdX = 0;\n\nexport const Level = makeSprite({\n  init({ device, props }) {\n    return {\n      birdY: 10,\n      birdGravity: -12,\n      pipes: props.paused ? [] : [newPipe(device)],\n      score: 0,\n    };\n  },\n\n  loop({ props, state, getInputs, device }) {\n    if (props.paused) {\n      return state;\n    }\n\n    const inputs = getInputs();\n\n    let { birdGravity, birdY, pipes, score } = state;\n\n    birdGravity += 0.8;\n    birdY -= birdGravity;\n\n    if (inputs.pointer.justPressed || inputs.keysJustPressed[" "]) {\n      birdGravity = -12;\n    }\n\n    const lastPipe = pipes[pipes.length - 1];\n    if (lastPipe.x < 140) {\n      pipes = [...pipes, newPipe(device)]\n        // Remove the pipes off screen on left\n        .filter(\n          (pipe) =>\n            pipe.x > -(device.size.width + device.size.widthMargin + pipeWidth)\n        );\n    }\n\n    if (didHitPipe(birdY, device.size, pipes)) {\n      device.audio("/audio/boop.wav").play();\n      props.gameOver(state.score);\n    }\n\n    // Move pipes to the left\n    pipes = pipes.map((pipe) => {\n      let passed = pipe.passed;\n      if (!passed && pipe.x < birdX - birdWidth / 2 - pipeWidth / 2) {\n        // Mark pipe as having passed bird\'s x position\n        passed = true;\n        score++;\n      }\n      return { ...pipe, passed, x: pipe.x - speedX };\n    });\n\n    return {\n      birdGravity,\n      birdY,\n      pipes,\n      score,\n    };\n  },\n\n  render({ state, device }) {\n    const { size } = device;\n    return [\n      t.rectangle({\n        color: "#add8e6",\n        width: size.width + size.widthMargin * 2,\n        height: size.height + size.heightMargin * 2,\n      }),\n      Bird({\n        id: "bird",\n        x: birdX,\n        y: state.birdY,\n        rotation: Math.max(-30, state.birdGravity * 3 - 30),\n      }),\n      ...state.pipes.map((pipe, index) =>\n        Pipe({\n          id: `pipe-${index}`,\n          pipe,\n          x: pipe.x,\n        })\n      ),\n      t.text({\n        text: `Score: ${state.score}`,\n        color: "white",\n        x: -device.size.width / 2 + 10,\n        y: device.size.height / 2 + device.size.heightMargin - 80,\n        font: {\n          align: "left",\n        },\n      }),\n    ];\n  },\n});\n\nfunction newPipe(device) {\n  const height = device.size.height + device.size.heightMargin * 2;\n  const randomY = (height - pipeGap * 2) * (device.random() - 0.5);\n\n  return {\n    x: device.size.width + device.size.widthMargin + 50,\n    gapY: randomY,\n    passed: false,\n  };\n}\n\nfunction didHitPipe(birdY, size, pipes) {\n  if (\n    birdY - birdHeight / 2 < -(size.height / 2 + size.heightMargin) ||\n    birdY + birdHeight / 2 > size.height / 2 + size.heightMargin\n  ) {\n    // hit bottom or top\n    return true;\n  }\n  for (const pipe of pipes) {\n    if (\n      pipe.x > birdX + birdWidth / 2 + pipeWidth / 2 ||\n      pipe.x < birdX - birdWidth / 2 - pipeWidth / 2\n    ) {\n      // bird isn\'t at pipe\n      continue;\n    }\n    const {\n      yUpperTop,\n      yUpperBottom,\n      yLowerTop,\n      yLowerBottom,\n    } = getPipeYPositions(size, pipe.gapY);\n    const topPipeRect = {\n      x: pipe.x,\n      y: (yUpperTop + yUpperBottom) / 2,\n      width: pipeWidth,\n      height: yUpperTop - yUpperBottom,\n    };\n    const bottomPipeRect = {\n      x: pipe.x,\n      y: (yLowerTop + yLowerBottom) / 2,\n      width: pipeWidth,\n      height: yLowerTop - yLowerBottom,\n    };\n    // Check a few points at edges of bird\n    const birdPoints = [\n      { x: birdX + birdWidth / 2, y: birdY + birdHeight / 2 },\n      { x: birdX + birdWidth / 2, y: birdY - birdHeight / 2 },\n      { x: birdX, y: birdY + birdHeight / 2 },\n      { x: birdX, y: birdY - birdHeight / 2 },\n      { x: birdX - birdWidth / 2, y: birdY + birdHeight / 2 },\n      { x: birdX - birdWidth / 2, y: birdY - birdHeight / 2 },\n    ];\n    if (\n      birdPoints.some(\n        (point) =>\n          pointInRect(point, topPipeRect) || pointInRect(point, bottomPipeRect)\n      )\n    ) {\n      // Bird hit a pipe!\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction pointInRect(point, rect) {\n  return (\n    point.x > rect.x - rect.width / 2 &&\n    point.x < rect.x + rect.width / 2 &&\n    point.y > rect.y - rect.height / 2 &&\n    point.y < rect.y + rect.height / 2\n  );\n}\n',highlight:[45]},{file:"index.js",code:'import { makeSprite, t } from "@replay/core";\nimport { Level } from "./level";\nimport { Menu } from "./menu";\n\nexport const Game = makeSprite({\n  init({ device, preloadFiles, updateState }) {\n    Promise.all([\n      device.storage.getItem("highScore"),\n      preloadFiles({\n        imageFileNames: ["/img/bird.png"],\n        audioFileNames: ["/audio/boop.wav"],\n      }),\n    ]).then(([highScore]) => {\n      updateState((state) => {\n        return {\n          ...state,\n          view: "menu",\n          highScore: Number(highScore || "0"),\n        };\n      });\n    });\n\n    return {\n      view: "loading",\n      attempt: 0,\n      highScore: 0,\n    };\n  },\n\n  render({ state, updateState, device }) {\n    if (state.view === "loading") {\n      return [\n        t.text({\n          color: "black",\n          text: "Loading...",\n        }),\n      ];\n    }\n\n    const inMenuScreen = state.view === "menu";\n\n    return [\n      Level({\n        id: `level-${state.attempt}`,\n        paused: inMenuScreen,\n        gameOver: (score) => {\n          updateState((prevState) => {\n            let { highScore } = prevState;\n            if (score > highScore) {\n              highScore = score;\n              device.storage.setItem("highScore", String(highScore));\n            }\n            return {\n              ...prevState,\n              view: "menu",\n              highScore,\n            };\n          });\n        },\n      }),\n      inMenuScreen\n        ? Menu({\n            id: "menu",\n            highScore: state.highScore,\n            start: () => {\n              updateState((prevState) => {\n                return {\n                  ...prevState,\n                  view: "level",\n                  attempt: prevState.attempt + 1,\n                };\n              });\n            },\n          })\n        : null,\n    ];\n  },\n});\n\nexport const gameProps = {\n  id: "Game",\n  size: {\n    width: 400,\n    height: 600,\n    maxHeightMargin: 150,\n  },\n  defaultFont: {\n    family: "Helvetica",\n    size: 24,\n  },\n};\n',highlight:[11]}],Game:y,gameProps:b})}},160:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a}));var r=n(161),i={text:function(e){return{type:"text",props:Object(r.b)({testId:e.testId,font:e.font,text:e.text,color:e.color,gradient:e.gradient,strokeColor:e.strokeColor,strokeThickness:e.strokeThickness},e)}},circle:function(e){return{type:"circle",props:Object(r.b)({testId:e.testId,radius:e.radius,color:e.color},e)}},rectangle:function(e){return{type:"rectangle",props:Object(r.b)({testId:e.testId,width:e.width,height:e.height,color:e.color,gradient:e.gradient},e)}},rectangleArray:function(e){return{type:"rectangleArray",mask:e.mask||null,props:e.props.map((function(e){return Object(r.b)({testId:e.testId,width:e.width,height:e.height,color:e.color},e)}))}},line:function(e){var t;return{type:"line",props:Object(r.b)({testId:e.testId,color:e.color,fillColor:e.fillColor,thickness:null!==(t=e.thickness)&&void 0!==t?t:1,lineCap:e.lineCap||"butt",path:e.path,fillGradient:e.fillGradient},e)}},image:function(e){return{type:"image",props:Object(r.b)({testId:e.testId,fileName:e.fileName,width:e.width,height:e.height},e)}},imageArray:function(e){return{type:"imageArray",fileName:e.fileName,mask:e.mask||null,props:e.props.map((function(e){return Object(r.b)({testId:e.testId,width:e.width,height:e.height},e)}))}},spriteSheet:function(e){return{type:"spriteSheet",props:Object(r.b)({testId:e.testId,fileName:e.fileName,columns:e.columns,rows:e.rows,index:e.index,width:e.width,height:e.height},e)}}};n(162);function a(e){return function(t){return{type:"custom",spriteObj:e,props:t}}}},161:function(e,t,n){"use strict";function r(e){var t,n,r;return{x:e.x||0,y:e.y||0,rotation:e.rotation||0,opacity:Math.min(1,Math.max(0,null!==(t=e.opacity)&&void 0!==t?t:1)),scaleX:null!==(n=e.scaleX)&&void 0!==n?n:1,scaleY:null!==(r=e.scaleY)&&void 0!==r?r:1,anchorX:e.anchorX||0,anchorY:e.anchorY||0,mask:e.mask||null,show:e.show||!0}}function i(e,t){var n,r,i,a,o=e;return o.x=t.x||0,o.y=t.y||0,o.rotation=t.rotation||0,o.opacity=Math.min(1,Math.max(0,null!==(n=t.opacity)&&void 0!==n?n:1)),o.scaleX=null!==(r=t.scaleX)&&void 0!==r?r:1,o.scaleY=null!==(i=t.scaleY)&&void 0!==i?i:1,o.anchorX=t.anchorX||0,o.anchorY=t.anchorY||0,o.mask=t.mask||null,o.show=null===(a=t.show)||void 0===a||a,o}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}))},162:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(161);function i(e,t){var n;switch(e.type){case"rectangleArray":var i=t;return Object(r.b)({testId:i.testId,width:i.width||10,height:i.height||10,color:i.color||"black"},i);case"textArray":var a=t;return Object(r.b)({testId:a.testId,font:a.font,text:a.text||"",color:a.color||"black",gradient:a.gradient,strokeColor:a.strokeColor,strokeThickness:a.strokeThickness},a);case"circleArray":var o=t;return Object(r.b)({testId:o.testId,radius:o.radius||10,color:o.color||"black",gradient:o.gradient},o);case"lineArray":var s=t;return Object(r.b)({testId:s.testId,color:s.color,fillColor:s.fillColor,thickness:null!==(n=s.thickness)&&void 0!==n?n:1,lineCap:s.lineCap||"butt",path:s.path||[],gradient:s.gradient,fillGradient:s.fillGradient},s);case"imageArray":var u=t;return Object(r.b)({testId:u.testId,width:u.width||10,height:u.height||10},u)}}},166:function(e,t,n){"use strict";n.d(t,"a",(function(){return Ge}));var r=n(0),i=n.n(r),a=n(171),o=n(170),s=n(177),u=n(3),c=n(173),l=n(172),d=n(167),p=n(168),f=n(174),h=n.n(f),v=n(56),m=n.n(v);function g(e){var t=e.codesTs,n=e.codesJs;return i.a.createElement(d.a,{defaultValue:"js",groupId:"code",values:[{label:"JavaScript",value:"js"},{label:"TypeScript",value:"ts"}]},i.a.createElement(p.a,{value:"js"},i.a.createElement(y,{lang:"js",codes:n})),i.a.createElement(p.a,{value:"ts"},i.a.createElement(y,{lang:"ts",codes:t})))}function y(e){var t=e.lang,n=e.codes,a=n.map((function(e){return e.file})),o=Object(r.useState)(a[0]),s=o[0],u=o[1],c=n.find((function(e){return e.file===s}));return i.a.createElement("div",{style:{marginTop:-12}},i.a.createElement("div",{style:{position:"sticky",top:0,backgroundColor:"white",zIndex:1}},a.map((function(e){return i.a.createElement("button",{className:m.a.fileButton+(s===e?" "+m.a.fileButtonSelected:""),key:e,onClick:function(){return u(e)}},e)}))),i.a.createElement(b,{key:c.file,lang:t,code:c.code,highlight:c.highlight}))}function b(e){var t=e.lang,n=e.code,r=e.highlight,a=n.replace("/img/bird.png","bird.png").replace("/audio/boop.wav","boop.wav");return i.a.createElement(c.a,Object(u.a)({},c.b,{theme:l.a,code:a,language:t}),(function(e){var t=e.className,n=e.style,a=e.tokens,o=e.getLineProps,s=e.getTokenProps;return i.a.createElement("div",{className:m.a.codeBlockContent},i.a.createElement("div",{tabIndex:"0",className:h()(t,m.a.codeBlock)},i.a.createElement("div",{className:m.a.codeBlockLines,style:n},a.map((function(e,t){1===e.length&&""===e[0].content&&(e[0].content="\n");var n=o({line:e,key:t}),a=null==r?void 0:r.flatMap((function(e){if("number"==typeof e)return e;var t=e.split("-").map(Number),n=t[0],r=t[1];return Array.from({length:r-n+1}).map((function(e,t){return t+n}))}));return null!=a&&a.includes(t+1)&&(n.className+=" docusaurus-highlight-code-line"),i.a.createElement("div",n,i.a.createElement("span",{style:{display:"inline-block",width:30,textAlign:"right",marginRight:16,opacity:.5,userSelect:"none"}},t+1),e.map((function(e,t){return i.a.createElement("span",s({token:e,key:t}))})))})))))}))}var x=n(163),A=n.n(x),w=n(164),S=n(165);function _(e,t,n){return E.apply(this,arguments)}function E(){return(E=Object(w.a)(A.a.mark((function e(t,n,r){return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([].concat(T(t,n.audioFileNames||[],r.audioElements,r.loadAudioFile),T(t,n.imageFileNames||[],r.imageElements,(function(e){return r.loadImageFile(e,!1)})),T(t,n.imageFileNamesScaleNearestPixel||[],r.imageElements,(function(e){return r.loadImageFile(e,!0)}))));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t,n,r){return t.map((function(t){if(n[t]){n[t].globalSpriteIds.push(e);var i=n[t].data;return"then"in i?i:Promise.resolve()}var a=r(t).then((function(e){n[t].data=e}));return n[t]={globalSpriteIds:[e],data:a},a}))}function P(e,t){R(e,t.audioElements,t.cleanupAudioFile),R(e,t.imageElements,t.cleanupImageFile)}function R(e,t,n){for(var r in t){var i=t[r].globalSpriteIds,a=i.indexOf(e);-1!==a&&(1===i.length?(n(r),delete t[r]):t[r].globalSpriteIds.splice(a,1))}}var I=n(161),k=n(162);var F={identityMatrix:[1,0,0,1,0,0],getNewIdentity3fv:function(){return new Float32Array([1,0,0,0,1,0,0,0,1])},getScaleMatrix:function(e,t){return[e,0,0,t,0,0]},getTranslateMatrix:function(e,t){return[1,0,0,1,e,t]},multiply:function(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=t[0],c=t[1],l=t[2],d=t[3],p=t[4],f=t[5];return[n*u+i*c,r*u+a*c,n*l+i*d,r*l+a*d,n*p+i*f+o,r*p+a*f+s]},transformMut:function(e,t,n,r,i,a,o,s,u,c,l){var d=Math.cos(a),p=Math.sin(a),f=e[0],h=e[1],v=e[2],m=e[3],g=e[4],y=e[5],b=u*d*r,x=u*p*r,A=c*-p*i,w=c*d*i,S=d*r*o-p*i*s+t,_=p*r*o+d*i*s+n;l[0]=f*b+v*x,l[1]=h*b+m*x,l[2]=f*A+v*w,l[3]=h*A+m*w,l[4]=f*S+v*_+g,l[5]=h*S+m*_+y},toUniform3fvMut:function(e,t){t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1},scaleToUniform3fvMut:function(e,t,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],u=e[4],c=e[5];r[0]=i*t,r[1]=a*t,r[2]=0,r[3]=o*n,r[4]=s*n,r[5]=0,r[6]=u,r[7]=c,r[8]=1},multiplyPooled:function(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=t[0],c=t[1],l=t[2],d=t[3],p=t[4],f=t[5];return L[0]=n*u+i*c,L[1]=r*u+a*c,L[2]=n*l+i*d,L[3]=r*l+a*d,L[4]=n*p+i*f+o,L[5]=r*p+a*f+s,L},getTranslateMatrixPooled:function(e,t){return M[4]=e,M[5]=t,M},getScaleMatrixPooled:function(e,t){return O[0]=e,O[3]=t,O},getRotateMatrixPooled:function(e){var t=Math.sin(e),n=Math.cos(e);return C[0]=n,C[1]=t,C[2]=-t,C[3]=n,C},getScalePooled:function(e){return U.scaleX=Math.hypot(e[0],e[2]),U.scaleY=Math.hypot(e[1],e[3]),U},invertPooled:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=t*i-n*r;if(!s)return null;return s=1/s,B[0]=i*s,B[1]=-n*s,B[2]=-r*s,B[3]=t*s,B[4]=(r*o-i*a)*s,B[5]=(n*a-t*o)*s,B}};var L=[0,0,0,0,0,0];var M=[1,0,0,1,0,0];var O=[0,0,0,0,0,0];var C=[0,0,0,0,0,0];var U={scaleX:0,scaleY:0};var B=[0,0,0,0,0,0];function N(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=1),F.transformMut(e,n.x,n.y,n.scaleX,n.scaleY,-n.rotation*D,-n.anchorX,-n.anchorY,r,i,t)}var z=[0,0,0,0,0,0];function Y(e,t,n,r){return void 0===n&&(n=1),void 0===r&&(r=1),N(e,z,t,n,r),z}var D=Math.PI/180;function j(e,t,n,r,i,a,o,s,u,c,l,d,p,f){var h=e.baseProps;Object(I.b)(h,t);var v=r.addToStack(h),m=e.getSprites(t,v,o,s,u,f),g=e.prevChildIdsSet,y=e.prevChildIds,b=0;d.startRenderSprite(h,v,null),X(m,e,n,r,i,a,s,u,c,l,d,p,f,(function(e){y[b]=e,b++,g.delete(e)})),d.endRenderSprite(r.removeFromStack()),b<y.length&&(y.length=b);for(var x,A=Object(S.a)(g);!(x=A()).done;){var w,_=x.value,E=e.childContainers[_];G(((w={})[_]=E,w),c,n),delete e.childContainers[_]}e.prevChildIdsSet.clear();for(var T,P=Object(S.a)(y);!(T=P()).done;){var R=T.value;e.prevChildIdsSet.add(R)}if(e.prevChildIdsSet.size<y.length){var k=y.find((function(e,t){return y.indexOf(e)!==t}));throw Error("Duplicate Sprite id "+k)}}function G(e,t,n){for(var r in e){var i=e[r];"custom"===i.type&&function(){var e=t+"--"+r;G(i.childContainers,e,n),i.loadFilesPromise&&i.loadFilesPromise.then((function(){P(e,n.assetUtils)}))}(),i.cleanup()}}function X(e,t,n,r,i,a,o,s,u,c,l,d,p,f){for(var h=0;h<e.length;h++){var v=e[h];if(v)if("context"===v.type)X(v.sprites,t,n,r,i,a,o,s,u,c,l,d,[].concat(p,[v]),f);else if("native"===v.type)!function(){f(v.props.id);var e=c.nativeSpriteMap,n=c.nativeSpriteUtils,i=e[v.name];if(!i)throw Error('Cannot find Native Sprite "'+v.name+'"');var a=t.childContainers[v.props.id];if(!a||"native"!==a.type){var o={type:"native",props:v.props,state:i.create({props:v.props,parentGlobalId:u,getState:function(){return o.state},utils:n}),updateSprite:function(){l.startNativeSprite(),i.loop({props:o.props,state:o.state,parentGlobalId:u,utils:n,spriteToGameCoords:function(e,t,n){var i=F.multiplyPooled(r.getTopStack().transformationGameCoords,F.getTranslateMatrixPooled(e,t));n.x=i[4],n.y=i[5]}}),l.endNativeSprite()},cleanup:function(){i.cleanup({state:this.state,parentGlobalId:u})}};t.childContainers[v.props.id]=o,a=o}a.props=v.props,a.updateSprite()}();else if("pure"===v.type){f(v.props.id);var m=t.childContainers[v.props.id];m&&"pure"===m.type||(m=$(v),t.childContainers[v.props.id]=m),q(m,v.props,r,n.size,c.nativeSpriteUtils.didResize,o,l)}else if("custom"===v.type){f(v.props.id);var g=!1,y=t.childContainers[v.props.id],b=u+"--"+v.props.id;y&&"custom"===y.type||(g=!0,y=V(v,n,i,a,r,t.prevTime,b,p),t.childContainers[v.props.id]=y),j(y,v.props,n,r,i,a,g,o,s,b,c,l,d,p)}else if("mutable"===v.type){if(!v.props.id)throw Error("Mutable sprite must have id prop in non-Mutable Sprites");f(v.props.id);var x=t.childContainers[v.props.id],A=u+"--"+v.props.id,w=!1;if(!x||"mutable"!==x.type){if(w=!0,"mutable"!==(x=K(v,n,r,i,a,t.prevTime,A,[],l,d,c)).type)throw Error("Can only render mutable Sprite");t.childContainers[v.props.id]=x}for(var S in v.props)x.props[S]=v.props[S];var _=r.addToStack(x.props);l.startRenderSprite(x.props,_,x.maskState),x.updateSprites(w),l.endRenderSprite(r.removeFromStack())}else l.renderTexture(r.getTopStack(),v,l.getInitTextureState(v),null)}}var W=1/60*1e3;function V(e,t,n,r,i,a,o,s){var u,c,l=e.spriteObj,d=e.props,p=[],f=function(e){p.push(e)},h=null,v=null;l.init&&(u=l.init({props:d,getState:function(){if(!h)throw Error("Cannot call getState synchronously in init");return h.state},device:t,getInputs:function(){return n(i.getStack((null==h?void 0:h.stackIndex)||0).transformationGameCoords,(null==h?void 0:h.inputs)||r())},updateState:f,getContext:function(e){var t=s.find((function(t){return t.context===e}));if(!t)throw Error("No context setup");return t.value},preloadFiles:(c=Object(w.a)(A.a.mark((function e(n){var r;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=_(o,n,t.assetUtils),h?h.loadFilesPromise=r:v=r,e.next=4,r;case 4:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})}));var m=function(){for(var e=0;e<p.length;){var t=p[e];h.state=t(h.state),e++}p.length=0},g=function(){return h.state};return h={type:"custom",state:u,inputs:r(),baseProps:Object(I.a)(d),childContainers:{},prevChildIds:[],prevChildIdsSet:new Set,prevTime:a,currentLag:0,loadFilesPromise:v,stackIndex:null,getSprites:function(e,r,a,o,s,u){var c=this;m(),null===this.stackIndex&&(this.stackIndex=i.getStackIndex());var d=function(e){var t=u.find((function(t){return t.context===e}));if(!t)throw Error("No context setup");return t.value};!a&&l.loop&&(this.state=l.loop({props:e,state:this.state,device:t,getInputs:function(){return n(r.transformationGameCoords,c.inputs)},updateState:f,getState:g,getContext:d})),m();var p=l[o];p||(p="renderPXL"===o&&l.renderXL?l.renderXL:l.render);var h=p({props:e,state:this.state,device:t,getInputs:function(){return n(r.transformationGameCoords,c.inputs)},updateState:f,getState:g,getContext:d,extrapolateFactor:s});return m(),h},cleanup:function(){var e;null===(e=l.cleanup)||void 0===e||e.call(l,{state:this.state,device:t})}}}function H(e,t){var n,r=e.deviceHeight>e.deviceWidth,i=!1;return"portrait"in t?(n=r?t.portrait:t.landscape,i=!0):n=t,n.minHeightXL&&e.deviceHeight>=n.minHeightXL||n.minWidthXL&&e.deviceWidth>=n.minWidthXL?i&&r?"renderPXL":"renderXL":i&&r?"renderP":"render"}function J(e,t,n,r){switch(e.type){case"mutable":e.updateSelf();var i=n.addToStack(e.props);t.startRenderSprite(e.props,i,e.maskState),e.updateSprites(r),t.endRenderSprite(n.removeFromStack());break;case"mutableArray":for(var a in e.updateSprites(),e.containersArray){var o=e.containersArray[a],s=n.addToStack(o.props);t.startRenderSprite(o.props,s,o.maskState),o.updateSprites(r),t.endRenderSprite(n.removeFromStack())}break;case"mutTexture":e.updateTexture(),t.renderTexture(n.getTopStack(),e.texture,e.textureState,e.maskState);break;case"mutOnChange":r=r||e.updateOnChange();for(var u,c=Object(S.a)(e.containers);!(u=c()).done;){J(u.value,t,n,r)}break;case"mutArrayTexture":e.updateTextureArray(),t.renderTexture(n.getTopStack(),e.texture,e.textureState,e.maskState);break;case"mutRun":e.updateRun();break;case"mutContext":for(var l,d=Object(S.a)(e.containers);!(l=d()).done;){J(l.value,t,n,r)}break;case"native":e.updateSprite();break;default:!function(e){throw new Error("Replay unreachable error")}()}}function K(e,t,n,r,i,a,o,s,u,c,l){var d,p,f;if(null===e)return null;switch(e.type){case"text":case"circle":case"rectangle":case"image":case"line":case"spriteSheet":var h=e.props,v=e.update;return null==v||v(h),{type:"mutTexture",texture:e,textureState:u.getInitTextureState(e),maskState:u.getInitMaskState(e.props.mask),updateTexture:function(){null==v||v(this.texture.props)},cleanup:function(){return null}};case"rectangleArray":case"textArray":case"circleArray":case"lineArray":case"imageArray":var m=e.array(),g=e.update;return e.props=Array.from({length:m.length}).map((function(t,n){var r=Object(k.a)(e,e.newProps(m[n],n));return null==g||g(r,m[n],n),r})),{type:"mutArrayTexture",texture:e,array:e.array,textureState:u.getInitTextureState(e),maskState:u.getInitMaskState(e.mask),cleanup:function(){return null},pooledProps:[],updateTextureArray:function(){var t=this.array(),n=t.length,r=this.texture.props.length,i=n-r;if(i>0)for(var a=0;a<i;a++)if(this.pooledProps.length>0)this.texture.props.push(this.pooledProps.pop());else{var o=Object(k.a)(e,e.newProps(t[r+a],r+a));this.texture.props.push(o)}else if(i<0)for(var s=-i;s>0;)s--,this.pooledProps.push(this.texture.props.pop());for(var u=0;u<this.texture.props.length;u++){var l=this.texture.props[u];null==g||g(l,t[u],u),c&&e.testId&&(l.testId=e.testId(t[u],u))}}};case"onChange":var y=e.value();return{type:"mutOnChange",value:y,containers:e.sprites().map((function(e,d){return K(e,t,n,r,i,a,o+"--"+y+"-"+d,s,u,c,l)})).filter(Z),updateOnChange:function(){var d=e.value();return this.value!==d&&(this.value=d,this.cleanup(),this.containers=e.sprites().map((function(e,p){return K(e,t,n,r,i,a,o+"--"+d+"-"+p,s,u,c,l)})).filter(Z),!0)},cleanup:function(){for(var e,t=Object(S.a)(this.containers);!(e=t()).done;){e.value.cleanup()}}};case"run":return{type:"mutRun",updateRun:function(){e.fn()},cleanup:function(){return null}};case"conditional":var b=e.condition();return{type:"mutOnChange",value:b,containers:(b?e.trueSprites():e.falseSprites()).map((function(e,d){return K(e,t,n,r,i,a,o+"--"+b+"-"+d,s,u,c,l)})).filter(Z),updateOnChange:function(){var d=e.condition();return!this.value&&d?(this.value=!0,this.cleanup(),this.containers=e.trueSprites().map((function(e,d){return K(e,t,n,r,i,a,o+"--true-"+d,s,u,c,l)})).filter(Z),!0):!(!this.value||d)&&(this.value=!1,this.cleanup(),this.containers=e.falseSprites().map((function(e,d){return K(e,t,n,r,i,a,o+"--false-"+d,s,u,c,l)})).filter(Z),!0)},cleanup:function(){for(var e,t=Object(S.a)(this.containers);!(e=t()).done;){e.value.cleanup()}}};case"mutContext":var x=[].concat(s,[e]);return{type:"mutContext",containers:e.sprites.map((function(e,s){return K(e,t,n,r,i,a,o+"--"+s,x,u,c,l)})).filter(Z),cleanup:function(){for(var e,t=Object(S.a)(this.containers);!(e=t()).done;){e.value.cleanup()}}};case"native":var E=l.nativeSpriteMap,T=l.nativeSpriteUtils,R=E[e.name];if(!R)throw Error('Cannot find Native Sprite "'+e.name+'"');var L=R.create({props:e.props,parentGlobalId:o,getState:function(){return O.state},utils:T}),M={props:e.props,state:L,parentGlobalId:o,utils:T,spriteToGameCoords:function(e,t,r){var i=F.multiplyPooled(n.getTopStack().transformationGameCoords,F.getTranslateMatrixPooled(e,t));r.x=i[4],r.y=i[5]}},O={type:"native",props:e.props,state:L,updateSprite:function(){var t;u.startNativeSprite(),null===(t=e.update)||void 0===t||t.call(e,this.props),R.loop(M),u.endNativeSprite()},cleanup:function(){R.cleanup({state:O.state,parentGlobalId:o})}};return O;case"mutableArray":var C=e.spriteObj,U=e.update,B=function(t,n){var r,i,a=e.props(t,n);return Object(I.b)(a,a),null===(r=e.update)||void 0===r||r.call(e,a,t,n),null===(i=e.updateAll)||void 0===i||i.call(e,a),{type:"mutable",spriteObj:C,props:a}},N=[];return{type:"mutableArray",props:e.props,update:e.update,filter:e.filter,array:e.array,key:e.key,prevIdsA:N,prevIdsB:N,isOnSamePrevIdRef:!0,onPrevIdA:!0,containersArray:e.array().map((function(t,n){return void 0===e.filter||e.filter(t,n)?t:null})).reduce((function(d,p,f){if(null===p)return d;var h=e.key(p,f);return d[h]=K(B(p,f),t,n,r,i,a,o+"--"+h,s,u,c,l),d}),{}),updateSprites:function(){for(var d,p,f=this.array(),h=this.onPrevIdA?this.prevIdsA:this.prevIdsB,v=this.onPrevIdA?this.prevIdsB:this.prevIdsA,m=0,g=0,y=0;y<f.length;y++){var b=f[y];if(!1!==(null===(d=this.filter)||void 0===d?void 0:d.call(this,b,y))){var x=e.key(b,y);h[m]=x,m++;var A=this.containersArray[x];A||(g++,A=K(B(b,y),t,n,r,i,a,o+"--"+x,s,u,c,l),this.containersArray[x]=A),null===(p=e.updateAll)||void 0===p||p.call(e,A.props),null==U||U(A.props,f[y],y)}}m<h.length&&(h.length=m);var w=h.length,_=v.length+g;if(w>_){var E=h.find((function(e,t){return h.indexOf(e)!==t}));throw Error("Duplicate key "+E)}if(w<_){for(var T,P=new Set(v),R=Object(S.a)(h);!(T=R()).done;){var I=T.value;P.delete(I)}for(var k,F=Object(S.a)(P);!(k=F()).done;){var L=k.value;this.containersArray[L].cleanup(),delete this.containersArray[L]}}this.onPrevIdA=!this.onPrevIdA,this.isOnSamePrevIdRef&&(this.isOnSamePrevIdRef=!1,this.prevIdsB=[].concat(this.prevIdsB))},cleanup:function(){for(var e in this.containersArray)this.containersArray[e].cleanup()}};case"mutable":{var z=e.spriteObj,Y=null;function D(e){var t=s.find((function(t){return t.context===e}));if(!t)throw Error("No context setup");return t.value()}var j=e.props;Object(I.b)(j,j),null===(d=e.update)||void 0===d||d.call(e,j);var G=null,X=null===(p=z.init)||void 0===p?void 0:p.call(z,{props:j,device:t,getState:function(){if(!G)throw Error("Cannot call getState synchronously in init");return G.state},getInputs:function(){return r(n.getStack((null==G?void 0:G.stackIndex)||0).transformationGameCoords,(null==G?void 0:G.inputs)||i())},getContext:D,preloadFiles:(f=Object(w.a)(A.a.mark((function e(n){var r;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=_(o,n,t.assetUtils),G?G.loadFilesPromise=r:Y=r,e.next=4,r;case 4:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})}),W={props:j,state:X,device:t,getInputs:function(){return r(n.getStack((null==G?void 0:G.stackIndex)||0).transformationGameCoords,(null==G?void 0:G.inputs)||i())},getContext:D};return G={type:"mutable",props:j,state:X,inputs:i(),stackIndex:null,maskState:u.getInitMaskState(e.props.mask),childContainers:z.render({props:j,state:X,device:t,getInputs:function(){return r(n.getStack((null==G?void 0:G.stackIndex)||0).transformationGameCoords,(null==G?void 0:G.inputs)||i())},getContext:D}).map((function(e,d){return K(e,t,n,r,i,a,o+"--"+d,s,u,c,l)})).filter(Z),updateSelf:function(){var t;null===(t=e.update)||void 0===t||t.call(e,j)},updateSprites:function(e){var t;null===this.stackIndex&&(this.stackIndex=n.getStackIndex()),e||null===(t=z.loop)||void 0===t||t.call(z,W);for(var r,i=Object(S.a)(this.childContainers);!(r=i()).done;){J(r.value,u,n,e)}},cleanup:function(){for(var e,n,r=Object(S.a)(this.childContainers);!(n=r()).done;){n.value.cleanup()}null===(e=z.cleanup)||void 0===e||e.call(z,{state:this.state,device:t}),this.loadFilesPromise&&this.loadFilesPromise.then((function(){P(o,t.assetUtils)}))},loadFilesPromise:Y}}}}function $(e){var t=e.spriteObj;return{type:"pure",childContainers:{},prevChildIds:[],prevChildIdsSet:new Set,baseProps:Object(I.a)(e.props),getSprites:function(e,n,r,i){if(this.prevProps&&this.cache&&!t.shouldRerender(this.prevProps,e)&&!r)return this.prevProps=e,this.cache;var a=t[i];return a||(a="renderPXL"===i&&t.renderXL?t.renderXL:t.render),this.prevProps=e,{type:"pureSprites",sprites:a({props:e,size:n})}},cleanup:function(){return null}}}function q(e,t,n,r,i,a,o){var s=e.baseProps;Object(I.b)(s,t);var u=e.getSprites(t,r,i,a);return"cache"===u.type?(Q(u,o,n),u):function(e,t,n,r,i,a,o){var s=e.baseProps,u=e.prevChildIdsSet,c=e.prevChildIds,l=0;o.startRenderSprite(s,n.addToStack(s),null);for(var d=new Array(t.length),p=0,f=0;f<t.length;f++){var h=t[f];if(h)if("pure"===h.type){c[l]=h.props.id,l++,u.delete(h.props.id);var v=e.childContainers[h.props.id];v&&"pure"===v.type||(v=$(h),e.childContainers[h.props.id]=v),d[p]=q(v,h.props,n,r,i,a,o),p++}else o.renderTexture(n.getTopStack(),h,o.getInitTextureState(h),null),d[p]=h,p++}p<d.length&&(d.length=p);o.endRenderSprite(n.removeFromStack());for(var m,g=Object(S.a)(u);!(m=g()).done;){var y=m.value;delete e.childContainers[y]}var b={type:"cache",baseProps:s,items:d};e.cache=b,l<c.length&&(c.length=l);if(e.prevChildIdsSet=new Set(c),e.prevChildIdsSet.size<c.length){var x=c.find((function(e,t){return c.indexOf(e)!==t}));throw Error("Duplicate Sprite id "+x)}return b}(e,u.sprites,n,r,i,a,o)}function Q(e,t,n){var r=n.addToStack(e.baseProps);t.startRenderSprite(e.baseProps,r,null);for(var i=0;i<e.items.length;i++){var a=e.items[i];"cache"===a.type?Q(a,t,n):t.renderTexture(r,a,t.getInitTextureState(a),null)}t.endRenderSprite(n.removeFromStack())}function Z(e){return null!=e}var ee={keysDown:{},keysJustPressed:{},pointer:{pressed:!1,numberPressed:0,justPressed:!1,justReleased:!1,x:0,y:0}},te=[];var ne=[1,0,0,1,0,0];function re(e,t){t.keysDown=ee.keysDown,t.keysJustPressed=ee.keysJustPressed,t.pointer.pressed=ee.pointer.pressed,t.pointer.numberPressed=ee.pointer.numberPressed,t.pointer.justPressed=ee.pointer.justPressed,t.pointer.justReleased=ee.pointer.justReleased;var n=F.invertPooled(e);if(!n)return t;ne[4]=ee.pointer.x,ne[5]=ee.pointer.y;var r=F.multiplyPooled(n,ne);return t.pointer.x=r[4],t.pointer.y=r[5],t}function ie(){return{keysDown:{},keysJustPressed:{},pointer:{pressed:!1,numberPressed:0,justPressed:!1,justReleased:!1,x:0,y:0}}}function ae(e){["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," "].includes(e.key)&&!(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement)&&e.preventDefault(),ee.keysDown[e.key]=!0,ee.keysJustPressed[e.key]=!0}function oe(e){ee.keysDown[e.key]=void 0}function se(e,t,n){te.includes(n)||(te=[].concat(te,[n])),ee.pointer.pressed=!0,ee.pointer.numberPressed=te.length,ee.pointer.justPressed=!0,ee.pointer.x=e,ee.pointer.y=t}function ue(e,t){ee.pointer.x=e,ee.pointer.y=t}function ce(e,t,n){0===(te=te.filter((function(e){return e!==n}))).length&&(ee.pointer.justPressed=!1,ee.pointer.pressed=!1),ee.pointer.numberPressed=te.length,ee.pointer.justReleased=!0,ee.pointer.x=e,ee.pointer.y=t}function le(e){te=te.filter((function(t){return t!==e})),ee.pointer.numberPressed=te.length,0===te.length&&(ee.pointer.justPressed=!1,ee.pointer.pressed=!1)}function de(){for(var e in ee.keysJustPressed)ee.keysJustPressed[e]=void 0;ee.pointer.justPressed=!1,ee.pointer.justReleased=!1}function pe(e,t,n,r){var i;"portrait"in r?i=t>e?r.portrait:r.landscape:i=r;var a=i,o=a.width,s=a.height,u=a.maxWidthMargin,c=void 0===u?0:u,l=a.maxHeightMargin;if("game-coords"===n||0===e||0===t)return{width:o,height:s,widthMargin:0,heightMargin:0,fullWidth:o,fullHeight:s,deviceWidth:o,deviceHeight:s};var d=o/s;if(d>e/t){var p=e,f=p/d,h=f/s*(void 0===l?0:l),v=Math.min(t,f+2*h),m=(v-f)/2*(s/f);return{width:o,height:s,widthMargin:0,heightMargin:m,fullWidth:o,fullHeight:s+2*m,deviceWidth:p,deviceHeight:v}}var g=t,y=g*d,b=y/o*c,x=Math.min(e,y+2*b),A=(x-y)/2*(o/y);return{width:o,height:s,widthMargin:A,heightMargin:0,fullWidth:o+2*A,fullHeight:s,deviceWidth:x,deviceHeight:g}}function fe(){var e={};return{start:function(t,n){var r=window.setTimeout((function(){delete e[i],t()}),n),i=String(r);return e[i]={timeoutId:r,callback:t,timeStartedMs:Date.now(),timeRemainingMs:n,isPaused:!1},i},pause:function(t){var n=e[t];if(n&&!n.isPaused){var r=Date.now()-n.timeStartedMs;n.timeRemainingMs-=r,n.isPaused=!0,window.clearTimeout(n.timeoutId)}},resume:function(t){var n=e[t];if(n&&n.isPaused){n.timeStartedMs=Date.now(),n.isPaused=!1;var r=window.setTimeout((function(){delete e[t],n.callback()}),n.timeRemainingMs);n.timeoutId=r}},cancel:function(t){var n=e[t];n&&(window.clearTimeout(n.timeoutId),delete e[t])}}}function he(){return(he=Object(w.a)(A.a.mark((function e(t,n){var r,i,a;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n;case 2:return r=e.sent,e.next=5,r.arrayBuffer();case 5:return i=e.sent,e.next=8,new Promise((function(e,n){t.decodeAudioData(i,e,n)}));case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e,t){return function(n){if(!t[n])throw Error('Audio file "'+n+'" was not preloaded');var r=t[n].data;if("then"in r)throw Error('Audio file "'+n+'" did not finish loading before it was used');var i=r.buffer,a=r.playState;return{getPosition:function(){return me(e,r.playState)},play:function(o){var s,u=!1,c=!1,l=1;if("number"==typeof o)s=o;else if(o){s=o.fromPosition;var d=o.loop;u=void 0===d?u:d;var p=o.overwrite;c=void 0===p?c:p;var f=o.playbackRate;l=void 0===f?l:f}var h=e.createBufferSource();h.buffer=i,h.playbackRate.value=l;var v=e.createGain();h.connect(v),v.connect(e.destination);var m=null!=s?s:me(e,a);try{h.start(void 0,m)}catch(y){return}h.loop=u,h.onended=function(){var e;if(t[n]){var r=t[n].data;"then"in r||!1!==(null===(e=r.playState)||void 0===e?void 0:e.isPaused)||delete r.playState}};var g=a&&!a.isPaused;g&&!c||(a&&g&&(a.sample.onended=null,a.sample.stop()),r.playState={playTime:e.currentTime,sample:h,alreadyPlayedTime:m,isPaused:!1,gainNode:v})},pause:function(){a&&!a.isPaused&&(a.sample.onended=null,a.sample.stop(),r.playState=Object.assign({},a,{alreadyPlayedTime:me(e,a),isPaused:!0}))},getStatus:function(){return r.playState&&!1===r.playState.isPaused?"playing":"paused"},getDuration:function(){return i.duration},getVolume:function(){return r.playState?r.playState.gainNode.gain.value:1},setVolume:function(t){var n=r.playState;if(n)if("number"==typeof t)n.gainNode.gain.setValueAtTime(Math.max(Math.min(1,t),0),e.currentTime);else{var i=t.type,a=t.fadeTo,o=t.fadeTime,s=Math.max(Math.min(1,a),0);"linear"===i?n.gainNode.gain.linearRampToValueAtTime(s,e.currentTime+o):n.gainNode.gain.exponentialRampToValueAtTime(s,e.currentTime+o)}}}}}function me(e,t){return t?t.isPaused?t.alreadyPlayedTime:(e.currentTime-t.playTime)*t.sample.playbackRate.value+t.alreadyPlayedTime:0}function ge(){return{get:function(e,t){fetch(e).then((function(e){return e.json()})).then(t)},post:function(e,t,n){fetch(e,{method:"POST",body:JSON.stringify(t)}).then((function(e){return e.json()})).then(n)},put:function(e,t,n){fetch(e,{method:"PUT",body:JSON.stringify(t)}).then((function(e){return e.json()})).then(n)},delete:function(e,t){fetch(e,{method:"DELETE"}).then((function(e){return e.json()})).then(t)}}}function ye(){return{getItem:(t=Object(w.a)(A.a.mark((function e(t){return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",localStorage.getItem(t));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)}),setItem:(e=Object(w.a)(A.a.mark((function e(t,n){return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==n){e.next=3;break}return localStorage.removeItem(t),e.abrupt("return");case 3:localStorage.setItem(t,n);case 4:case"end":return e.stop()}}),e)}))),function(t,n){return e.apply(this,arguments)})};var e,t}var be="__replay_resolution_v1__";function xe(){return{copy:function(e,t){navigator.clipboard?navigator.clipboard.writeText(e).then((function(){t()})).catch((function(e){t(e)})):t(new Error(window.isSecureContext?"Couldn't access clipboard":"Clipboard only available on HTTPS or localhost"))}}}function Ae(){if("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)return!0;return window.matchMedia("(touch-enabled),(-webkit-touch-enabled),(-moz-touch-enabled),(-o-touch-enabled),(-ms-touch-enabled)").matches}function we(e,t,n){var r=Se(e,e.VERTEX_SHADER,t),i=Se(e,e.FRAGMENT_SHADER,n),a=e.createProgram();if(e.attachShader(a,r),e.attachShader(a,i),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS))return a;throw Error(e.getProgramInfoLog(a)||"")}function Se(e,t,n){var r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))return r;throw Error(e.getShaderInfoLog(r)||"")}var _e={black:"#000000",silver:"#c0c0c0",gray:"#808080",white:"#ffffff",maroon:"#800000",red:"#ff0000",purple:"#800080",fuchsia:"#ff00ff",green:"#008000",lime:"#00ff00",olive:"#808000",yellow:"#ffff00",navy:"#000080",blue:"#0000ff",teal:"#008080",aqua:"#00ffff"},Ee={r:0,g:0,b:0};function Te(e,t){e.startsWith("#")||(e=_e[e]||_e.black);var n=Number.parseInt(e.slice(1),16),r=n>>16,i=n>>8&255,a=255&n;return void 0!==t?(Ee.r=t*(r/255),Ee.g=t*(i/255),Ee.b=t*(a/255)):(Ee.r=r/255,Ee.g=i/255,Ee.b=a/255),Ee}function Pe(e,t,n,r,i,a,o,s){var u=t.colors.length;e.uniform1i(n,0),e.uniform1f(r,u),"linearHoriz"===t.type?(e.uniform1f(i,t.width/o),e.uniform1i(a,1)):(e.uniform1f(i,t.height/s),e.uniform1i(a,0))}function Re(e,t){var n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);var r=t.colors.length;return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,1,0,e.RGBA,e.UNSIGNED_BYTE,function(e){for(var t=Array.from({length:4*e.colors.length}),n=0;n<e.colors.length;n++){var r=Te(e.colors[n]),i=r.r,a=r.g,o=r.b,s=1;if(e.opacities){var u=e.opacities[n];void 0!==u&&(s=u)}var c=4*n;t[c]=255*i,t[c+1]=255*a,t[c+2]=255*o,t[c+3]=255*s}return new Uint8Array(t)}(t)),n}function Ie(e,t,n){var r=we(e,"\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\n\nuniform mat3 u_matrix;\nuniform mat3 u_texture_matrix;\n\nvarying vec2 v_texcoord;\n\nconst mat3 flipY = mat3(\n  1.0, 0.0, 0.0,\n  0.0, -1.0, 0.0,\n  0.0, 1.0, 1.0\n);\n\nvoid main() {\n  gl_Position = vec4(u_matrix * vec3(a_position, 1.0), 1.0);\n  v_texcoord = (flipY * u_texture_matrix * vec3(a_texcoord, 1.0)).xy;\n}","\nprecision mediump float;\n\nvarying vec2 v_texcoord;\n\nuniform sampler2D u_texture;\nuniform float u_opacity;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, v_texcoord) * u_opacity;\n}\n"),i=t.createVertexArrayOES();t.bindVertexArrayOES(i);var a=e.getAttribLocation(r,"a_position"),o=e.getAttribLocation(r,"a_texcoord"),s=e.getUniformLocation(r,"u_matrix"),u=e.getUniformLocation(r,"u_texture_matrix"),c=e.getUniformLocation(r,"u_texture"),l=e.getUniformLocation(r,"u_opacity"),d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0);e.bufferData(e.ARRAY_BUFFER,new Float32Array([-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5]),e.STATIC_DRAW);var p=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,p),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0);e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW),t.bindVertexArrayOES(null);var f=F.getNewIdentity3fv(),h=F.getNewIdentity3fv();return function(a,o,d,p,v,m){a!==n.texture&&(e.bindTexture(e.TEXTURE_2D,a),n.texture=a),r!==n.program&&(e.useProgram(r),n.program=r,t.bindVertexArrayOES(i)),F.scaleToUniform3fvMut(o,d,p,f),e.uniformMatrix3fv(s,!1,f),function(e,t){if(!e)return void F.toUniform3fvMut(F.identityMatrix,t);var n=e.columns,r=e.rows,i=e.index,a=i%n,o=Math.floor(i/n)%r,s=F.multiplyPooled(F.getTranslateMatrixPooled(a/n,(r-1-o)/r),F.getScaleMatrixPooled(1/n,1/r));F.toUniform3fvMut(s,t)}(m,h),e.uniformMatrix3fv(u,!1,h),e.uniform1i(c,0),e.uniform1f(l,v),e.drawArrays(e.TRIANGLES,0,6)}}function ke(e,t){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),n}function Fe(e,t,n,r,i){var a=Object.assign({},r,e.font),o=a.size,s=void 0===o?10:o,u=a.weight,c=void 0===u?"normal":u,l=a.style,d=void 0===l?"normal":l,p=a.family,f=a.align,h=void 0===f?"center":f,v=a.baseline,m=void 0===v?"middle":v,g=d+" "+c+" "+(s?s+"px":"")+" "+(p?""+p:""),y=e.text,b=e.strokeThickness,x=void 0===b?1:b,A=e.color;return function(e,t,n,r,i){var a=n*r,o=n*i;a!==e.width||o!==e.height?(e.width=a,e.height=o,t.translate(a/2,o/2),t.scale(n,n)):t.clearRect(-a/2,-o/2,e.width,e.height)}(t,n,i,function(e,t,n,r){return e.font=r,e.measureText(t).width+2*n}(n,y,x,g),1.5*s*("middle"!==m?2:1)),function(e,t,n,r,i,a,o,s,u){e.font=t,e.textBaseline=a,e.textAlign=o,u&&(e.strokeStyle=u,e.lineWidth=i,e.strokeText(n,0,0));e.fillStyle=s?Le(e,s):r,e.fillText(n,0,0)}(n,g,y,A,x,m,"center",e.gradient,e.strokeColor),h}var Le=function(e,t){for(var n="linearHoriz"===t.type?e.createLinearGradient(-t.width/2,0,t.width/2,0):e.createLinearGradient(0,-t.height/2,0,t.height/2),r=0;r<t.colors.length;r++){var i=t.colors[r];if(t.opacities){var a=t.opacities[r];if(void 0!==a){var o=Te(i);i="rgba("+255*o.r+", "+255*o.g+", "+255*o.b+", "+a}}var s=r/(t.colors.length-1);n.addColorStop(s,i)}return n};function Me(e,t,n){var r=we(e,"\nattribute vec2 a_origin;\nattribute vec2 a_point1;\nattribute vec2 a_point2;\n\nuniform mat3 u_matrix;\nuniform float u_half_thickness;\n\nvoid main() {\n  if (a_point1 == a_point2) {\n    // Avoid normalize a zero vector\n    gl_Position = vec4(u_matrix * vec3(a_origin, 1.0), 1.0);\n    return;\n  }\n\n  vec2 normal = normalize(a_point2 - a_point1);\n  vec2 tangent = vec2(-normal.y, normal.x);\n  vec2 pos = a_origin + tangent * u_half_thickness;\n\n  gl_Position = vec4(u_matrix * vec3(pos, 1.0), 1.0);\n}\n","\nprecision mediump float;\n\nuniform vec4 u_colour;\n\nvoid main() {\n  gl_FragColor = u_colour;\n}\n"),i=t.createVertexArrayOES(),a=t.createVertexArrayOES(),o=e.getAttribLocation(r,"a_point1"),s=e.getAttribLocation(r,"a_point2"),u=e.getAttribLocation(r,"a_origin"),c=e.getUniformLocation(r,"u_matrix"),l=e.getUniformLocation(r,"u_half_thickness"),d=e.getUniformLocation(r,"u_colour"),p=e.createBuffer();t.bindVertexArrayOES(i),e.bindBuffer(e.ARRAY_BUFFER,p),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,24,8),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,24,16),e.enableVertexAttribArray(u),e.vertexAttribPointer(u,2,e.FLOAT,!1,24,0),t.bindVertexArrayOES(a),e.bindBuffer(e.ARRAY_BUFFER,p),e.enableVertexAttribArray(u),e.vertexAttribPointer(u,2,e.FLOAT,!1,96,0),e.disableVertexAttribArray(o),e.disableVertexAttribArray(s),t.bindVertexArrayOES(null);var f=F.getNewIdentity3fv();return function(o,s,u,h,v,m,g,y){if(u.length<=1)s.lineCaps=null;else{if(r!==n.program&&(e.useProgram(r),n.program=r,e.bindBuffer(e.ARRAY_BUFFER,p)),function(e,t){var n=24,r=t.length*n;e.strokePath.length!==r&&(e.strokePath=new Float32Array(r));for(var i=e.strokePath,a=void 0,o=void 0,s=void 0,u=void 0,c=t[0][0],l=t[0][1],d=0;d<t.length;d++){var p=d*n;a=s,o=u,s=c,u=l;var f=t[d+1];f?(c=f[0],l=f[1]):(c=s,l=u),void 0!==a&&void 0!==o||(a=s,o=u),i[p]=s,i[p+1]=u,i[p+2]=a,i[p+3]=o,i[p+4]=s,i[p+5]=u,i[p+6]=s,i[p+7]=u,i[p+8]=s,i[p+9]=u,i[p+10]=a,i[p+11]=o,i[p+12]=s,i[p+13]=u,i[p+14]=s,i[p+15]=u,i[p+16]=c,i[p+17]=l,i[p+18]=s,i[p+19]=u,i[p+20]=c,i[p+21]=l,i[p+22]=s,i[p+23]=u}}(s,u),e.bufferData(e.ARRAY_BUFFER,s.strokePath,e.DYNAMIC_DRAW),F.toUniform3fvMut(o,f),e.uniformMatrix3fv(c,!1,f),e.uniform1f(l,h/2),m){var b=Te(m,y),x=b.r,A=b.g,w=b.b;e.uniform4f(d,x,A,w,y),t.bindVertexArrayOES(a),e.drawArrays(e.TRIANGLE_FAN,0,u.length)}if(v){var S=Te(v,y),_=S.r,E=S.g,T=S.b;e.uniform4f(d,_,E,T,y),t.bindVertexArrayOES(i),e.drawArrays(e.TRIANGLE_STRIP,0,4*u.length),"round"===g?function(e,t){var n=e[0],r=e[1],i=e[e.length-2],a=e[e.length-1];t.lineCaps||(t.lineCaps=[{x:0,y:0,angleRad:0,textureState:{points:new Float32Array}},{x:0,y:0,angleRad:0,textureState:{points:new Float32Array}}]);t.lineCaps[0].x=n[0],t.lineCaps[0].y=n[1],t.lineCaps[0].angleRad=Math.atan2(r[1]-n[1],r[0]-n[0])+Math.PI/2,t.lineCaps[1].x=a[0],t.lineCaps[1].y=a[1],t.lineCaps[1].angleRad=Math.atan2(a[1]-i[1],a[0]-i[0])-Math.PI/2}(u,s):s.lineCaps=null}else s.lineCaps=null}}}function Oe(e,t,n){var r=we(e,"\nattribute vec2 a_point;\n\nuniform mat3 u_matrix;\nuniform bool u_horizontal;\nuniform float u_ramp_width;\nuniform float u_gradient_length;\n\nvarying float ramp_distance;\n\nvoid main() {\n  float grad_coord = 0.0;\n\n  if (u_horizontal) {\n    grad_coord = a_point.x;\n  } else {\n    grad_coord = -a_point.y;\n  }\n\n  // mixValue varies from 0 -> 1 along gradient length\n  float mixValue = 0.5 + grad_coord / u_gradient_length;\n\n  float rampPixelLength = 1.0 / u_ramp_width;\n\n  ramp_distance =\n    // Left offset to middle of pixel\n    rampPixelLength / 2.0 +\n    // Distance along ramp width\n    mixValue * (1.0 - rampPixelLength);\n\n  gl_Position = vec4(u_matrix * vec3(a_point, 1.0), 1.0);\n}\n","\nprecision mediump float;\n\nuniform sampler2D u_ramp_texture;\nuniform float u_opacity;\n\nvarying float ramp_distance;\n\nvoid main() {\n  gl_FragColor = texture2D(\n    u_ramp_texture,\n    vec2(ramp_distance, 0.5)\n  ) * u_opacity;\n}\n"),i=t.createVertexArrayOES();t.bindVertexArrayOES(i);var a=e.getAttribLocation(r,"a_point"),o=e.getUniformLocation(r,"u_matrix"),s=e.getUniformLocation(r,"u_ramp_texture"),u=e.getUniformLocation(r,"u_ramp_width"),c=e.getUniformLocation(r,"u_gradient_length"),l=e.getUniformLocation(r,"u_horizontal"),d=e.getUniformLocation(r,"u_opacity"),p=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,p),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),t.bindVertexArrayOES(null);var f=F.getNewIdentity3fv();return function(a,h,v,m,g,y){m.length<=1||(v!==n.texture&&(e.bindTexture(e.TEXTURE_2D,v),n.texture=v),r!==n.program&&(e.useProgram(r),n.program=r,t.bindVertexArrayOES(i),e.bindBuffer(e.ARRAY_BUFFER,p)),function(e,t){var n=2*e.length;t.linePath.length!==n&&(t.linePath=new Float32Array(n));for(var r=t.linePath,i=0;i<e.length;i++){var a=e[i],o=a[0],s=a[1],u=2*i;r[u]=o,r[u+1]=s}}(m,h),e.bufferData(e.ARRAY_BUFFER,h.linePath,e.DYNAMIC_DRAW),F.toUniform3fvMut(a,f),e.uniformMatrix3fv(o,!1,f),e.uniform1f(d,y),Pe(e,g,s,u,c,l,1,1),e.drawArrays(e.TRIANGLE_FAN,0,m.length))}}function Ce(e,t,n){var r=we(e,"\n#define PI 3.1415926538\n\nattribute float a_vertex;\nuniform float u_num_vertex;\nuniform float u_radius;\nuniform float u_angle_multiplier;\n\nuniform mat3 u_matrix;\n\nvoid main() {\n  if (a_vertex < 0.0) {\n    // Origin\n    gl_Position = vec4(u_matrix * vec3(0.0, 0.0, 1.0), 1.0);\n    return;\n  }\n  float dr = a_vertex / u_num_vertex;\n  float angle = dr * PI * 2.0 * u_angle_multiplier;\n\n  vec2 position = vec2(cos(angle), sin(angle)) * u_radius;\n\n  gl_Position = vec4(u_matrix * vec3(position, 1.0), 1.0);\n}\n","\nprecision mediump float;\n\nuniform vec4 u_colour;\n\nvoid main() {\n  gl_FragColor = u_colour;\n}\n"),i=t.createVertexArrayOES();t.bindVertexArrayOES(i);var a=e.getAttribLocation(r,"a_vertex"),o=e.getUniformLocation(r,"u_num_vertex"),s=e.getUniformLocation(r,"u_radius"),u=e.getUniformLocation(r,"u_angle_multiplier"),c=e.getUniformLocation(r,"u_matrix"),l=e.getUniformLocation(r,"u_colour"),d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,1,e.FLOAT,!1,0,0),t.bindVertexArrayOES(null);var p=F.getNewIdentity3fv();return function(a,f,h,v,m,g,y,b,x){r!==n.program&&(e.useProgram(r),n.program=r,t.bindVertexArrayOES(i),e.bindBuffer(e.ARRAY_BUFFER,d));var A=F.getScalePooled(a),w=A.scaleX,S=A.scaleY,_=Math.max(w*m,S*g)/2,E=Math.ceil(Math.PI*v*_*y);!function(e,t){var n=t+2;if(e.points.length!==n){e.points=new Float32Array(n);for(var r=-1;r<n-1;r++)e.points[r]=r}}(f,E),e.bufferData(e.ARRAY_BUFFER,f.points,e.DYNAMIC_DRAW),F.toUniform3fvMut(a,p),e.uniformMatrix3fv(c,!1,p);var T=Te(h,b),P=T.r,R=T.g,I=T.b;e.uniform4f(l,P,R,I,b),e.uniform1f(o,E),e.uniform1f(s,v),e.uniform1f(u,x?.5:1),e.drawArrays(e.TRIANGLE_FAN,0,E+2)}}function Ue(e,t,n,r){var i=we(e,"\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\nattribute vec4 a_matrix_abcd;\nattribute vec2 a_matrix_txty;\nattribute float a_opacity;\n\nvarying vec2 v_texcoord;\nvarying float v_opacity;\n\nconst mat3 flipY = mat3(\n  1.0, 0.0, 0.0,\n  0.0, -1.0, 0.0,\n  0.0, 1.0, 1.0\n);\n\nvoid main() {\n  mat3 matrix = mat3(\n    a_matrix_abcd.x, a_matrix_abcd.y, 0,\n    a_matrix_abcd.z, a_matrix_abcd.w, 0,\n    a_matrix_txty.x, a_matrix_txty.y, 1\n  );\n  gl_Position = vec4(matrix * vec3(a_position, 1.0), 1.0);\n  v_texcoord = (flipY * vec3(a_texcoord, 1.0)).xy;\n  v_opacity = a_opacity;\n}","\nprecision mediump float;\n\nvarying vec2 v_texcoord;\nvarying float v_opacity;\n\nuniform sampler2D u_texture;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, v_texcoord) * v_opacity;\n}\n"),a=n.createVertexArrayOES();n.bindVertexArrayOES(a);var o=e.getAttribLocation(i,"a_position"),s=e.getAttribLocation(i,"a_texcoord"),u=e.getAttribLocation(i,"a_matrix_abcd"),c=e.getAttribLocation(i,"a_matrix_txty"),l=e.getAttribLocation(i,"a_opacity"),d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0);e.bufferData(e.ARRAY_BUFFER,new Float32Array([-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5]),e.STATIC_DRAW);var p=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,p),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0);e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW);var f=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,f),e.enableVertexAttribArray(u),e.vertexAttribPointer(u,4,e.FLOAT,!1,24,0),t.vertexAttribDivisorANGLE(u,1),e.enableVertexAttribArray(c),e.vertexAttribPointer(c,2,e.FLOAT,!1,24,16),t.vertexAttribDivisorANGLE(c,1);var h=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,h),e.enableVertexAttribArray(l),e.vertexAttribPointer(l,1,e.FLOAT,!1,0,0),t.vertexAttribDivisorANGLE(l,1),n.bindVertexArrayOES(null),function(o,s,u,c,l){o!==r.texture&&(e.bindTexture(e.TEXTURE_2D,o),r.texture=o),i!==r.program&&(e.useProgram(i),r.program=i,n.bindVertexArrayOES(a)),function(e,t,n,r){var i=6,a=t.length*i;e.matrices.length!==a&&(e.matrices=new Float32Array(a));var o=e.matrices,s=t.length;e.opacities.length!==s&&(e.opacities=new Float32Array(s));for(var u=e.opacities,c=0;c<t.length;c++){var l=t[c],d=Y(n,l,l.width,l.height),p=c*i;o[p]=d[0],o[p+1]=d[1],o[p+2]=d[2],o[p+3]=d[3],o[p+4]=d[4],o[p+5]=d[5],u[c]=l.show?l.opacity*r:0}}(s,l,u,c),e.bindBuffer(e.ARRAY_BUFFER,f),e.bufferData(e.ARRAY_BUFFER,s.matrices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,s.opacities,e.DYNAMIC_DRAW),t.drawArraysInstancedANGLE(e.TRIANGLES,0,6,l.length)}}function Be(e,t,n,r){var i=we(e,"\nattribute vec2 a_position;\nattribute vec4 a_matrix_abcd;\nattribute vec2 a_matrix_txty;\nattribute vec4 a_colour;\n\nvarying vec4 v_colour;\n\nvoid main() {\n  mat3 matrix = mat3(\n    a_matrix_abcd.x, a_matrix_abcd.y, 0,\n    a_matrix_abcd.z, a_matrix_abcd.w, 0,\n    a_matrix_txty.x, a_matrix_txty.y, 1\n  );\n  gl_Position = vec4(matrix * vec3(a_position, 1.0), 1.0);\n  v_colour = a_colour;\n}\n","\nprecision mediump float;\n\nvarying vec4 v_colour;\n\nvoid main() {\n  gl_FragColor = v_colour;\n}\n"),a=n.createVertexArrayOES();n.bindVertexArrayOES(a);var o=e.getAttribLocation(i,"a_position"),s=e.getAttribLocation(i,"a_matrix_abcd"),u=e.getAttribLocation(i,"a_matrix_txty"),c=e.getAttribLocation(i,"a_colour"),l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0);e.bufferData(e.ARRAY_BUFFER,new Float32Array([-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5]),e.STATIC_DRAW);var d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,4,e.FLOAT,!1,24,0),t.vertexAttribDivisorANGLE(s,1),e.enableVertexAttribArray(u),e.vertexAttribPointer(u,2,e.FLOAT,!1,24,16),t.vertexAttribDivisorANGLE(u,1);var p=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,p),e.enableVertexAttribArray(c),e.vertexAttribPointer(c,4,e.FLOAT,!1,0,0),t.vertexAttribDivisorANGLE(c,1),n.bindVertexArrayOES(null),function(o,s,u,c){i!==r.program&&(e.useProgram(i),r.program=i,n.bindVertexArrayOES(a)),function(e,t,n,r){var i=6,a=4,o=r.length*i;e.matrices.length!==o&&(e.matrices=new Float32Array(o));var s=e.matrices,u=r.length*a;e.colours.length!==u&&(e.colours=new Float32Array(u));for(var c=e.colours,l=0;l<r.length;l++){var d=r[l],p=Y(t,d,d.width,d.height),f=l*i;s[f]=p[0],s[f+1]=p[1],s[f+2]=p[2],s[f+3]=p[3],s[f+4]=p[4],s[f+5]=p[5];var h=d.show?n*d.opacity:0,v=Te(d.color,h),m=v.r,g=v.g,y=v.b,b=l*a;c[b]=m,c[b+1]=g,c[b+2]=y,c[b+3]=h}}(s,o,u,c),e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,s.matrices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,p),e.bufferData(e.ARRAY_BUFFER,s.colours,e.DYNAMIC_DRAW),t.drawArraysInstancedANGLE(e.TRIANGLES,0,6,c.length)}}function Ne(e,t,n,r,i,a,o,s,u,c){var l=e.canvas.width,d=e.canvas.height,p=l*c/i;e.viewport(0,0,l,d);var f=r.getContext("2d"),h={texture:null,program:null},v=Ie(e,n,h),m=Ue(e,t,n,h),g=function(e,t,n){var r=we(e,"\nattribute vec2 a_position;\n\nuniform mat3 u_matrix;\n\nvoid main() {\n  gl_Position = vec4(u_matrix * vec3(a_position, 1.0), 1.0);\n}\n","\nprecision mediump float;\n\nuniform vec4 u_colour;\n\nvoid main() {\n  gl_FragColor = u_colour;\n}\n"),i=t.createVertexArrayOES();t.bindVertexArrayOES(i);var a=e.getAttribLocation(r,"a_position"),o=e.getUniformLocation(r,"u_matrix"),s=e.getUniformLocation(r,"u_colour"),u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5]),e.STATIC_DRAW),t.bindVertexArrayOES(null);var c=F.getNewIdentity3fv();return function(a,u,l,d,p){r!==n.program&&(e.useProgram(r),n.program=r,t.bindVertexArrayOES(i));var f=F.multiplyPooled(a,F.getScaleMatrixPooled(l,d));F.toUniform3fvMut(f,c),e.uniformMatrix3fv(o,!1,c);var h=Te(u,p),v=h.r,m=h.g,g=h.b;e.uniform4f(s,v,m,g,p),e.drawArrays(e.TRIANGLES,0,6)}}(e,n,h),y=Be(e,t,n,h),b=function(e,t,n){var r=we(e,"\nattribute vec2 a_point;\n\nuniform mat3 u_matrix;\nuniform bool u_horizontal;\nuniform float u_ramp_width;\nuniform float u_gradient_length;\n\nvarying float ramp_distance;\n\nvoid main() {\n  float grad_coord = 0.0;\n\n  if (u_horizontal) {\n    grad_coord = a_point.x;\n  } else {\n    grad_coord = -a_point.y;\n  }\n\n  // grad_coord = -0.5 / 0.5 is edges of rect\n  // mixValue varies from 0 -> 1 along gradient length\n  float mixValue = 0.5 + grad_coord / u_gradient_length;\n\n  float rampPixelLength = 1.0 / u_ramp_width;\n\n  ramp_distance =\n    // Left offset to middle of pixel\n    rampPixelLength / 2.0 +\n    // Distance along ramp width\n    mixValue * (1.0 - rampPixelLength);\n\n  gl_Position = vec4(u_matrix * vec3(a_point, 1.0), 1.0);\n}\n","\nprecision mediump float;\n\nuniform sampler2D u_ramp_texture;\nuniform float u_opacity;\n\nvarying float ramp_distance;\n\nvoid main() {\n  gl_FragColor = texture2D(\n    u_ramp_texture,\n    vec2(ramp_distance, 0.5)\n  ) * u_opacity;\n}\n"),i=t.createVertexArrayOES();t.bindVertexArrayOES(i);var a=e.getAttribLocation(r,"a_point"),o=e.getUniformLocation(r,"u_matrix"),s=e.getUniformLocation(r,"u_ramp_texture"),u=e.getUniformLocation(r,"u_ramp_width"),c=e.getUniformLocation(r,"u_gradient_length"),l=e.getUniformLocation(r,"u_horizontal"),d=e.getUniformLocation(r,"u_opacity"),p=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,p),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5]),e.STATIC_DRAW),t.bindVertexArrayOES(null);var f=F.getNewIdentity3fv();return function(a,p,h,v,m,g){p!==n.texture&&(e.bindTexture(e.TEXTURE_2D,p),n.texture=p),r!==n.program&&(e.useProgram(r),n.program=r,t.bindVertexArrayOES(i));var y=F.multiplyPooled(a,F.getScaleMatrixPooled(v,m));F.toUniform3fvMut(y,f),e.uniformMatrix3fv(o,!1,f),e.uniform1f(d,g),Pe(e,h,s,u,c,l,v,m),e.drawArrays(e.TRIANGLES,0,6)}}(e,n,h),x=Me(e,n,h),A=Oe(e,n,h),w=Ce(e,n,h),_=function(e,t,n){var r=we(e,"\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\n\nuniform mat3 u_matrix;\n\nvarying vec2 v_texcoord;\n\nconst mat3 flipY = mat3(\n  1.0, 0.0, 0.0,\n  0.0, -1.0, 0.0,\n  0.0, 1.0, 1.0\n);\n\nvoid main() {\n  gl_Position = vec4(u_matrix * vec3(a_position, 1.0), 1.0);\n  v_texcoord = (flipY * vec3(a_texcoord, 1.0)).xy;\n}","\nprecision mediump float;\n\nvarying vec2 v_texcoord;\n\nuniform sampler2D u_texture;\nuniform float u_opacity;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, v_texcoord) * u_opacity;\n}\n"),i=t.createVertexArrayOES();t.bindVertexArrayOES(i);var a=e.getAttribLocation(r,"a_position"),o=e.getAttribLocation(r,"a_texcoord"),s=e.getUniformLocation(r,"u_matrix"),u=e.getUniformLocation(r,"u_texture"),c=e.getUniformLocation(r,"u_opacity"),l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5]),e.STATIC_DRAW);var d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW),t.bindVertexArrayOES(null);var p=F.getNewIdentity3fv();return function(a,o,l,d,f,h){e.bindTexture(e.TEXTURE_2D,a),n.texture=a,r!==n.program&&(e.useProgram(r),n.program=r,t.bindVertexArrayOES(i));var v=F.multiplyPooled(o,F.getScaleMatrixPooled(l/h,d/h));F.toUniform3fvMut(v,p),e.uniformMatrix3fv(s,!1,p),e.uniform1i(u,0),e.uniform1f(c,f),e.drawArrays(e.TRIANGLES,0,6)}}(e,n,h);function E(t,n,r,o,s){var u,l;if(t){if(e.isEnabled(e.STENCIL_TEST))throw Error("Nested masks not supported");e.enable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.stencilFunc(e.ALWAYS,1,255),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE);var d=F.multiply(void 0===o||void 0===s||0===o&&0===s?r:F.multiply(r,F.getTranslateMatrix(o,s)),F.getTranslateMatrix(t.x,t.y));switch(e.colorMask(!1,!1,!1,!1),t.type){case"circleMask":null===n&&(n={value:null}),"circleMask"!==(null===(u=n.value)||void 0===u?void 0:u.type)&&(n.value={type:"circleMask",points:new Float32Array}),w(d,n.value,"",t.radius,i,a,c,1,!1);break;case"lineMask":null===n&&(n={value:null}),"lineMask"!==(null===(l=n.value)||void 0===l?void 0:l.type)&&(n.value={type:"lineMask",lineCaps:null,linePath:new Float32Array,strokePath:new Float32Array}),x(d,n.value,t.path,0,void 0," ","butt",1);break;case"rectangleMask":g(d,"",t.width,t.height,1)}e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,1,255),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}function T(){e.disable(e.STENCIL_TEST)}var P={},R=new Set,I=[0,0,0,0,0,0],k=Te(u),L=k.r,M=k.g,O=k.b;function C(t,n,r){var o=t.fillGradient;if(o){var s=o.type+"-"+o.colors.join("")+"-"+(o.opacities||[]).join(""),u=P[s];u?R.delete(s):(u={texture:Re(e,o),width:0,height:0,align:"center"},P[s]=u),A(I,r,u.texture,t.path,o,t.opacity*n)}if(t.color||t.fillColor){x(I,r,t.path,t.thickness,t.color,t.fillColor,t.lineCap,t.opacity*n);var c=t.color;if(r.lineCaps&&c)for(var l,d=Object(S.a)(r.lineCaps);!(l=d()).done;){var f=l.value,h=F.multiplyPooled(F.getTranslateMatrixPooled(f.x,f.y),F.getRotateMatrixPooled(f.angleRad)),v=F.multiplyPooled(I,h);w(v,f.textureState,c,t.thickness/2,i,a,p,t.opacity*n,!0)}}}function U(t,n){var i=t.text,a=t.color,o=t.strokeColor,u=t.font,l=u?i+"-"+a+"-"+o+"-"+u.size+"-"+u.weight+"-"+u.style+"-"+u.align:i+"-"+a+"-"+o,d=P[l];if(d)R.delete(l);else{var p=Fe(t,r,f,s,c);d={texture:ke(e,r),width:r.width,height:r.height,align:p},P[l]=d}var h=d,v=h.align,m=h.width,g=h.height;_(d.texture,"center"===v?I:F.multiplyPooled(I,F.getTranslateMatrixPooled(m/(2*c)*("left"===v?1:-1),0)),m,g,t.opacity*n,c)}return{newFrame:function(){e.clearColor(L,M,O,1),e.clear(e.COLOR_BUFFER_BIT);for(var t,n=Object(S.a)(R);!(t=n()).done;){var r=t.value;e.deleteTexture(P[r].texture),delete P[r]}for(var i in R.clear(),P)R.add(i);e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)},endFrame:function(){n.bindVertexArrayOES(null),h.program=null,h.texture=null},startRenderSprite:function(e,t,n){E(e.mask,n,t.transformation)},endRenderSprite:function(e){e.hasMask&&T()},renderTexture:function(t,n,r,s){if("imageArray"===n.type){if(0===n.props.length)return;var u=r;E(n.mask,s,t.transformation);var c=ze(o,n.fileName);return m(c.texture,u,t.transformation,t.opacity,n.props),void(n.mask&&T())}if("rectangleArray"===n.type){if(0===n.props.length)return;var l=r;return E(n.mask,s,t.transformation),y(t.transformation,l,t.opacity,n.props),void(n.mask&&T())}if("textArray"!==n.type)if("circleArray"!==n.type)if("lineArray"!==n.type){if(n.props.show){switch(N(t.transformation,I,n.props),E(n.props.mask,s,t.transformation,n.props.x,n.props.y),n.type){case"image":case"spriteSheet":var d=ze(o,n.props.fileName);v(d.texture,I,n.props.width,n.props.height,n.props.opacity*t.opacity,"spriteSheet"===n.type?n.props:null);break;case"line":var f=r;C(n.props,t.opacity,f);break;case"rectangle":var h=n.props.gradient;if(h){var x=h.type+"-"+h.colors.join("")+"-"+(h.opacities||[]).join(""),A=P[x];A?R.delete(x):(A={texture:Re(e,h),width:0,height:0,align:"center"},P[x]=A),b(I,A.texture,h,n.props.width,n.props.height,n.props.opacity*t.opacity)}else g(I,n.props.color,n.props.width,n.props.height,n.props.opacity*t.opacity);break;case"circle":w(I,r,n.props.color,n.props.radius,i,a,p,n.props.opacity*t.opacity,!1);break;case"text":U(n.props,t.opacity)}n.props.mask&&T()}}else{if(0===n.props.length)return;var _=r;E(n.mask,s,t.transformation),function(e,t){var n=t.props.length-e.stateByIndex.length;if(n>0)for(var r=0;r<n;r++)e.stateByIndex.push({lineCaps:null,linePath:new Float32Array,strokePath:new Float32Array});else n<0&&(e.stateByIndex.length=t.props.length)}(_,n);for(var k=0;k<n.props.length;k++){var F=n.props[k];F.show&&(N(t.transformation,I,F),C(F,t.opacity,_.stateByIndex[k]))}n.mask&&T()}else{if(0===n.props.length)return;var L=r;E(n.mask,s,t.transformation),function(e,t){var n=t.props.length-e.pointsByIndex.length;if(n>0)for(var r=0;r<n;r++)e.pointsByIndex.push({points:new Float32Array});else n<0&&(e.pointsByIndex.length=t.props.length)}(L,n);for(var M=0;M<n.props.length;M++){var O=n.props[M];O.show&&(N(t.transformation,I,O),w(I,L.pointsByIndex[M],O.color,O.radius,i,a,p,O.opacity*t.opacity,!1))}n.mask&&T()}else{if(0===n.props.length)return;E(n.mask,s,t.transformation);for(var B,z=Object(S.a)(n.props);!(B=z()).done;){var Y=B.value;Y.show&&(N(t.transformation,I,Y),U(Y,t.opacity))}n.mask&&T()}},startNativeSprite:function(){n.bindVertexArrayOES(null)},endNativeSprite:function(){h.program=null,h.texture=null,e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)},getInitTextureState:function(e){switch(e.type){case"imageArray":return{matrices:new Float32Array,opacities:new Float32Array};case"line":return{lineCaps:null,linePath:new Float32Array,strokePath:new Float32Array};case"circle":return{points:new Float32Array};case"rectangleArray":return{matrices:new Float32Array,colours:new Float32Array};case"circleArray":return{pointsByIndex:Array.from({length:e.array().length}).map((function(){return{points:new Float32Array}}))};case"lineArray":return{stateByIndex:Array.from({length:e.array().length}).map((function(){return{lineCaps:null,linePath:new Float32Array,strokePath:new Float32Array}}))};default:return null}},getInitMaskState:function(e){if(null===e)return{value:null};switch(e.type){case"lineMask":return{value:{type:e.type,lineCaps:null,linePath:new Float32Array,strokePath:new Float32Array}};case"circleMask":return{value:{type:e.type,points:new Float32Array}};case"rectangleMask":return{value:null}}}}}var ze=function(e,t){var n=e[t];if(!n)throw Error('Image file "'+t+'" was not preloaded');if("then"in n.data)throw Error('Image file "'+t+'" did not finish loading before it was used');return n.data},Ye={family:"sans-serif",size:12};function De(e,t,n){var r=t||{},i=r.dimensions,a=void 0===i?"game-coords":i,o=r.canvas,s=r.nativeSpriteMap,u=void 0===s?{}:s,c=r.windowSize,l=r.statsBegin,d=r.statsEnd,p=r.imageResolution,f=void 0===p?3:p,h=r.maxPixels,v=o||document.createElement("canvas");o||document.body.appendChild(v),v.id="replay-canvas";var m=document.createElement("canvas"),g=window.PointerEvent?"pointerdown":"touchstart",y=window.PointerEvent?"pointermove":"touchmove",b=window.PointerEvent?"pointerup":"touchend",x=window.PointerEvent?"pointercancel":"touchcancel",A=v.getContext("webgl",{stencil:!0});if(!A)return Error("WebGL not supported");var w=A,S=w.getExtension("ANGLE_instanced_arrays");if(!S)return Error("WebGL instancing not supported");var _=S,E=w.getExtension("OES_vertex_array_object");if(!E)return Error("WebGL VAO not supported");var T=E;w.enable(w.BLEND),w.blendFunc(w.ONE,w.ONE_MINUS_SRC_ALPHA),w.pixelStorei(w.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var P=new(window.AudioContext||window.webkitAudioContext),R=!0,I=!0,k=0,L=!1,M=0,O=0,C=function(){document.hidden&&I&&(M=k,P.suspend()),document.hidden||I||(L=!0,setTimeout((function(){P.suspend(),setTimeout((function(){P.resume()}),75)}),75)),I=!document.hidden};document.addEventListener("keydown",(function(e){R&&!e.repeat&&ae(e)}),!1),document.addEventListener("keyup",(function(e){R&&oe(e)}),!1),document.addEventListener("visibilitychange",C,!1),window.addEventListener("resize",X,!1);var U,B,z,Y,D,G=function(){return X({didScroll:!0})};function X(t){var n=Boolean(t&&"cleanup"in t&&t.cleanup),r=Boolean(t&&"didScroll"in t&&t.didScroll);if(!U||(document.removeEventListener(g,B),document.removeEventListener(y,z),document.removeEventListener(b,Y),document.removeEventListener(x,D),!n)){r&&U||(te.size=pe((null==c?void 0:c.width)||window.innerWidth,(null==c?void 0:c.height)||window.innerHeight,a,e.props.size));var i,o,s=window.devicePixelRatio||1,u=te.size.deviceWidth*s*ee.resolution,l=te.size.fullWidth*f;u>l?(i=Math.round(l),o=Math.round(te.size.fullHeight*f)):(i=Math.round(u),o=Math.round(te.size.deviceHeight*s*ee.resolution));var d=i/te.size.fullWidth;if(h&&!ee.hasSet&&i*o>h&&ee.resolution>.15)return ee.resolution-=.1,void X();v.width=i,v.height=o,v.style.width=te.size.deviceWidth+"px",v.style.height=te.size.deviceHeight+"px";var p=e.props.defaultFont||Ye,A=e.props.backgroundColor||"white",S=te.size.width+2*te.size.widthMargin,E=te.size.height+2*te.size.heightMargin,P=Ne(w,_,T,m,S,E,K,p,A,d),I=te.size.deviceWidth/S;Z.newFrame=P.newFrame,Z.endFrame=P.endFrame,Z.startRenderSprite=P.startRenderSprite,Z.endRenderSprite=P.endRenderSprite,Z.renderTexture=P.renderTexture,Z.startNativeSprite=P.startNativeSprite,Z.endNativeSprite=P.endNativeSprite,Z.getInitTextureState=P.getInitTextureState,Z.getInitMaskState=P.getInitMaskState,me.gameXToPlatformX=function(e){var t=e.canvasOffsetLeft,n=e.widthMargin,r=e.scale,i=e.width;return function(e){return t+r*(e+i/2+n)}}({canvasOffsetLeft:v.offsetLeft,width:te.size.width,widthMargin:te.size.widthMargin,scale:I}),me.gameYToPlatformY=function(e){var t=e.canvasOffsetTop,n=e.heightMargin,r=e.scale,i=e.height;return function(e){return t-r*(e-i/2-n)}}({canvasOffsetTop:v.offsetTop,height:te.size.height,heightMargin:te.size.heightMargin,scale:I}),me.didResize=!0,me.scale=I,me.size=te.size;var k=function(e){var t=e.canvasOffsetLeft,n=e.scrollX,r=e.widthMargin,i=e.scale,a=e.width;return function(e){return(e.clientX-t+n)/i-r-a/2}}({canvasOffsetLeft:v.offsetLeft,scrollX:window.scrollX,width:te.size.width,widthMargin:te.size.widthMargin,scale:I}),F=function(e){var t=e.canvasOffsetTop,n=e.scrollY,r=e.heightMargin,i=e.scale,a=e.height;return function(e){return-(e.clientY-t+n)/i+r+a/2}}({canvasOffsetTop:v.offsetTop,scrollY:window.scrollY,height:te.size.height,heightMargin:te.size.heightMargin,scale:I}),L=function(e,t){return e>te.size.width/2+te.size.widthMargin||e<-te.size.width/2-te.size.widthMargin||t>te.size.height/2+te.size.heightMargin||t<-te.size.height/2-te.size.heightMargin};B=function(e){if("changedTouches"in e){R=!1;for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t],r=k({clientX:n.screenX}),i=F({clientY:n.screenY});L(r,i)||(R=!0,se(r,i,n.identifier))}}else{var a=k(e),o=F(e);L(a,o)?R=!1:(R=!0,se(a,o,e.pointerId))}},z=function(e){if("changedTouches"in e)for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t],r=k({clientX:n.screenX}),i=F({clientY:n.screenY});L(r,i)||ue(r,i)}else{var a=k(e),o=F(e);L(a,o)||ue(a,o)}},Y=function(e){if("changedTouches"in e)for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t],r=k({clientX:n.screenX}),i=F({clientY:n.screenY});L(r,i)?le(n.identifier):ce(r,i,n.identifier)}else{var a=k(e),o=F(e);L(a,o)?le(e.pointerId):ce(a,o,e.pointerId)}},D=function(e){if("changedTouches"in e)for(var t=0;t<e.changedTouches.length;t++)le(e.changedTouches[t].identifier);else le(e.pointerId)},document.addEventListener(g,B,!1),document.addEventListener(y,z,!1),document.addEventListener(b,Y,!1),document.addEventListener(x,D,!1),U=te.size}}window.addEventListener("scroll",G,!1),document.addEventListener("contextmenu",(function(e){e.preventDefault()}));var J={},K={},$=function(e,t){return function(){throw Error("Failed to load "+e+' file "'+t+'"')}},q=(null==n?void 0:n.fileFetch)||fetch,Q={audioElements:J,imageElements:K,loadAudioFile:function(e){return function(e,t){return he.apply(this,arguments)}(P,q(e)).then((function(e){return{buffer:e,volume:1}})).catch($("audio",e))},loadImageFile:function(e,t){return new Promise((function(n,r){var i=new Image;i.addEventListener("load",(function(){n(function(e,t,n){var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);var i={texture:r,image:t};return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}(w,i,t))})),i.addEventListener("error",r),i.src=e})).catch($("image",e))},cleanupAudioFile:function(e){var t=J[e].data;!("then"in t)&&t.playState&&(t.playState.sample.onended=null,t.playState.sample.disconnect(),t.playState.sample.buffer=null)},cleanupImageFile:function(e){var t=K[e].data;"then"in t||w.deleteTexture(t.texture)}},Z={newFrame:function(){return null},endFrame:function(){return null},startRenderSprite:function(){return null},endRenderSprite:function(){return null},renderTexture:function(){return null},startNativeSprite:function(){return null},endNativeSprite:function(){return null},getInitTextureState:function(){return null},getInitMaskState:function(){return{value:null}}},ee={resolution:1,hasSet:!1,get:function(){return this.resolution},set:function(e){this.resolution=e,this.hasSet=!0,X(),te.storage.setItem(be,String(e))}},te=function(e,t,n,r,i){return Object.assign({isTouchScreen:Ae(),log:console.log,random:Math.random,timer:fe(),audio:ve(e,n.audioElements),assetUtils:n,network:ge(),storage:ye(),alert:{ok:function(e,t){alert(e),null==t||t()},okCancel:function(e,t){t(confirm(e))}},clipboard:xe(),size:t,now:function(){return new Date},resolution:i},r)}(P,pe((null==c?void 0:c.width)||window.innerWidth,(null==c?void 0:c.height)||window.innerHeight,a,e.props.size),Q,(null==n?void 0:n.device)||{},ee);te.storage.getItem(be).then((function(e){if(null!==e){var t=Number(e);isNaN(t)||ee.set(t)}}));var ne={mutDevice:te,getInputs:re,newInputs:ie,render:Z,isTestPlatform:!1},me={isLastFrame:!0,didResize:!1,scale:1,gameXToPlatformX:function(e){return e},gameYToPlatformY:function(e){return e},size:te.size},we=!1,Se=function e(){document.removeEventListener("keydown",e,!1),document.removeEventListener(g,e,!1),"suspended"===P.state&&P.resume(),P.onstatechange=function(){"suspended"!==P.state||document.hidden||P.resume()}};return document.addEventListener("keydown",Se,!1),document.addEventListener(g,Se,!1),function t(){var n=(null==c?void 0:c.width)||window.innerWidth,r=(null==c?void 0:c.height)||window.innerHeight;if(n&&r){X();var i=function(e,t,n,r){var i=e.mutDevice,a=e.getInputs,o=e.newInputs,s=e.isTestPlatform,u={index:0,stack:[{opacity:1,transformation:F.getScaleMatrix(2/i.size.fullWidth,2/i.size.fullHeight),transformationGameCoords:[].concat(F.identityMatrix),hasMask:!1}]},c=[0,0,0,0,0,0],l=[0,0,0,0,0,0],d={addToStack:function(e){var t=u.stack[u.index];N(t.transformation,c,e),N(t.transformationGameCoords,l,e),u.index++;var n=u.stack[u.index];if(n){n.opacity=t.opacity*e.opacity,n.hasMask=null!==e.mask;for(var r=0;r<c.length;r++)n.transformation[r]=c[r];for(var i=0;i<l.length;i++)n.transformationGameCoords[i]=l[i];return n}var a=[].concat(c),o=[].concat(l),s={opacity:t.opacity*e.opacity,hasMask:null!==e.mask,transformation:a,transformationGameCoords:o};return u.stack.push(s),s},removeFromStack:function(){var e=u.stack[u.index];return u.index--,e},getStack:function(e){return u.stack[e]},getStackIndex:function(){return u.index},getTopStack:function(){return u.stack[u.index]}},p=V(n,i,a,o,d,0,n.props.id,[]),f=r||n.props.size,h=H(i.size,f),v=0,m=0,g={isEmpty:!1,newFrame:e.render.newFrame,endFrame:e.render.endFrame,startRenderSprite:e.render.startRenderSprite,endRenderSprite:e.render.endRenderSprite,renderTexture:e.render.renderTexture,startNativeSprite:e.render.startNativeSprite,endNativeSprite:e.render.endNativeSprite,getInitTextureState:e.render.getInitTextureState,getInitMaskState:e.render.getInitMaskState};g.newFrame(),j(p,n.props,i,d,a,o,!0,h,0,n.props.id,t,g,s,[]),g.endFrame();var y=function(){return null},b=function(){return null},x=function(){return null},A=function(){return null},w=function(){return null},S=function(){return null},_=function(){return null};return e.render.getInitTextureState,e.render.getInitMaskState,{runNextFrame:function(r,c){var l=r-v;v=r,m+=l;var h=Math.floor(m/W);for(t.nativeSpriteUtils.didResize&&(u.stack[0].transformation=F.getScaleMatrix(2/i.size.fullWidth,2/i.size.fullHeight));h>0;){h--;var E=(m-=W)/W,T=H(i.size,f),P=0===h;P&&g.isEmpty?(g.isEmpty=!1,g.newFrame=e.render.newFrame,g.endFrame=e.render.endFrame,g.startRenderSprite=e.render.startRenderSprite,g.endRenderSprite=e.render.endRenderSprite,g.renderTexture=e.render.renderTexture,g.startNativeSprite=e.render.startNativeSprite,g.endNativeSprite=e.render.endNativeSprite):P||g.isEmpty||(g.isEmpty=!0,g.newFrame=y,g.endFrame=b,g.startRenderSprite=x,g.endRenderSprite=A,g.renderTexture=w,g.startNativeSprite=S,g.endNativeSprite=_),t.nativeSpriteUtils.isLastFrame=P,g.newFrame(),j(p,n.props,i,d,a,o,!1,T,E,n.props.id,t,g,s,[]),g.endFrame(),t.nativeSpriteUtils.didResize=!1,c()}}}}(ne,{nativeSpriteMap:u,nativeSpriteUtils:me},e).runNextFrame,a=null;o()}else setTimeout(t,50);function o(){null==d||d(),window.requestAnimationFrame(s)}function s(e){we||(null==l||l(),null===a&&(a=e-1/60),I?(L&&(L=!1,O+=e-M),k=e,i(e-a-O,de),o()):o())}}(),{cleanup:function(){v.width=v.width,o||document.body.removeChild(v),we=!0,document.removeEventListener("keydown",ae,!1),document.removeEventListener("keyup",oe,!1),document.removeEventListener("visibilitychange",C,!1),window.removeEventListener("resize",X,!1),window.removeEventListener("scroll",G,!1),X({cleanup:!0})},audioElements:J,imageElements:K,audioContext:P}}function je(e){var t=e.Game,n=e.gameProps,a=e.showReload,o=function(){var e=Object(r.useRef)(null),t=Object(r.useState)(null),n=t[0],i=t[1],a=function(){i(e.current.getBoundingClientRect())};Object(r.useEffect)((function(){return window.addEventListener("resize",a,!1),function(){return window.removeEventListener("resize",a,!1)}}),[]);var o=Object(r.useCallback)((function(t){null!==t&&(e.current=t,a())}),[]);return Object(r.useEffect)((function(){document.getElementById("iphone-img").onload=function(){a()}}),[]),[n,o]}(),s=o[0],u=o[1],c=Object(r.useState)(0),l=c[0],d=c[1],p=0,f=0,h=0;if(s&&s.height&&s.width){var v=375/667;s.width/s.height>v?(f=s.height*(667/900),p=f*v):(p=s.width*(375/460),f=p/v);var g=n.size.maxHeightMargin?0:.08*f;h=(s.height-f)/2+g}return Object(r.useEffect)((function(){if(p&&f){var e=document.getElementById("myCanvas"),r=De(t(n),{dimensions:"scale-up",canvas:e,windowSize:{width:p,height:f}}).cleanup;return function(){r()}}}),[p,f,l]),i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{ref:u,style:{height:"100%",width:"100%",display:"flex",justifyContent:"center"}},i.a.createElement("img",{id:"iphone-img",style:{userSelect:"none",objectFit:"contain",maxHeight:"100%"},src:"/img/iPhone8-Portrait-SpaceGray.png"})),a&&i.a.createElement("img",{className:m.a.refresh,src:"/img/reload.svg",width:20,height:20,onClick:function(){return d((function(e){return e+1}))}}),i.a.createElement("canvas",{id:"myCanvas",style:{position:"absolute",marginTop:h},width:p,height:f}))}function Ge(e){var t=e.part,n=e.MDXContent,r=e.codesTs,u=e.codesJs,c=e.Game,l=e.gameProps,d=e.image,p=e.isEnd,f=r&&u,h=c&&l?i.a.createElement(s.a,{fallback:i.a.createElement("div",null,"Preview")},(function(){return i.a.createElement(je,{Game:c,gameProps:l,showReload:f})})):i.a.createElement("div",null,i.a.createElement("img",{src:d}));return i.a.createElement(a.a,{title:"Tutorial - Part "+t,noFooter:!0},i.a.createElement("div",{style:{display:"flex",minWidth:1024,height:"calc(100vh - 60px)"}},i.a.createElement("div",{style:{flex:"1",overflow:"auto",padding:16,borderRight:"1px solid #ededed"}},i.a.createElement(n,null),i.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},t>1?i.a.createElement(o.a,{to:"/tutorial/"+(t-1)},"Back"):i.a.createElement("div",null),p?i.a.createElement("div",null):i.a.createElement(o.a,{to:"/tutorial/"+(t+1)},"Next"))),f?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{flex:"1",overflow:"auto",borderRight:"1px solid #ededed"}},i.a.createElement(g,{codesTs:r,codesJs:u})),i.a.createElement("div",{style:{flex:"1",display:"flex",justifyContent:"center"}},h)):i.a.createElement("div",{style:{flex:"2",display:"flex",justifyContent:"center"}},h)))}},71:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return u})),n.d(t,"default",(function(){return l}));var r=n(3),i=n(7),a=(n(0),n(159)),o={},s={unversionedId:"tutorial/19",id:"tutorial/19",isDocsHomePage:!1,title:"19",description:"19 - Audio",source:"@site/docs/tutorial/19.md",slug:"/tutorial/19",permalink:"/docs/tutorial/19",editUrl:"https://github.com/edbentley/replay/edit/master/website/docs/tutorial/19.md",version:"current"},u=[],c={toc:u};function l(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h1",{id:"19---audio"},"19 - Audio"),Object(a.b)("p",null,"The only thing our game is missing now is some sound! Let's play the boop sound that replay-starter comes with whenever the bird hits a pipe."),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"device")," parameter has an ",Object(a.b)("inlineCode",{parentName:"p"},"audio")," method, which takes a file name and returns a sound object. We can then call ",Object(a.b)("inlineCode",{parentName:"p"},"play()")," on it to play a sound."),Object(a.b)("p",null,"Lastly we need to ensure the audio file is being loaded in our ",Object(a.b)("inlineCode",{parentName:"p"},"Game")," Sprite."))}l.isMDXComponent=!0}}]);