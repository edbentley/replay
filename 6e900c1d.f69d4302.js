(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{113:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return p})),n.d(t,"default",(function(){return b}));var a=n(3),r=n(7),i=(n(0),n(158)),l=n(164),o=n(165),s={id:"thinking-in-replay",title:"Thinking in Replay"},c={unversionedId:"thinking-in-replay",id:"thinking-in-replay",isDocsHomePage:!1,title:"Thinking in Replay",description:"There's an excellent article in the React docs called Thinking in React, which is well worth a read. Here we'll show how some of those ideas apply to Replay, and why building games with it is a refreshing take on how you might have done them before.",source:"@site/docs/thinking-in-replay.md",slug:"/thinking-in-replay",permalink:"/docs/thinking-in-replay",editUrl:"https://github.com/edbentley/replay/edit/master/website/docs/thinking-in-replay.md",version:"current",sidebar:"someSidebar",previous:{title:"Top-Level Game",permalink:"/docs/top-level-game"},next:{title:"Mask",permalink:"/docs/mask"}},p=[],u={toc:p};function b(e){var t=e.components,s=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},u,s,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"There's an excellent article in the React docs called ",Object(i.b)("a",{parentName:"p",href:"https://reactjs.org/docs/thinking-in-react.html"},"Thinking in React"),", which is well worth a read. Here we'll show how some of those ideas apply to Replay, and why building games with it is a refreshing take on how you might have done them before."),Object(i.b)("p",null,Object(i.b)("img",{alt:"Diagram of player and platform",src:n(224).default})),Object(i.b)("p",null,"In this game we need to do 2 things:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Have the player jump"),Object(i.b)("li",{parentName:"ol"},"Handle the player landing on the platform")),Object(i.b)("p",null,"Many game engines will represent the player in a ",Object(i.b)("inlineCode",{parentName:"p"},"class"),". We might have something like:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js"},"class Player {\n  loop() {\n    if (this.jump) {\n      this.position.y += 4;\n    }\n  }\n}\n")),Object(i.b)("p",null,"Next we need to check if the player is touching the platform. Let's imagine we have some parent class to handle this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js"},"class Level {\n  player = new Player();\n  platform = new Platform();\n\n  loop() {\n    if (this.player.hits(this.platform)) {\n      this.player.position.y = this.platform.position.y + this.platform.height;\n    }\n  }\n}\n")),Object(i.b)("p",null,"Our player's position is being read and mutated in 2 different classes. When you scale this up to a large game, it can be confusing which classes are changing what values."),Object(i.b)("p",null,"Replay uses a one-way data flow approach. We model our player's position as ",Object(i.b)("em",{parentName:"p"},"state"),", and the state only lives in one place. Other Sprites can read the state (through their props), but only the Sprite which owns the state is allowed to change it. What's more, the state is changed through pure functions - no mutation required."),Object(i.b)("p",null,"If multiple Sprites need to access some state, we need to lift the state to a common parent Sprite. That parent Sprite is then responsible for managing the state."),Object(i.b)("p",null,Object(i.b)("img",{alt:"State flow diagram",src:n(225).default})),Object(i.b)("p",null,"Here we've lifted the player's position state to the ",Object(i.b)("inlineCode",{parentName:"p"},"Level")," Sprite, not the ",Object(i.b)("inlineCode",{parentName:"p"},"Player")," Sprite. If ",Object(i.b)("inlineCode",{parentName:"p"},"Player")," needs to update the position, it does so through a ",Object(i.b)("em",{parentName:"p"},"callback")," prop, e.g:"),Object(i.b)(l.a,{defaultValue:"js",groupId:"code",values:[{label:"JavaScript",value:"js"},{label:"TypeScript",value:"ts"}],mdxType:"Tabs"},Object(i.b)(o.a,{value:"js",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'{10-14} title="level.js"',"{10-14}":!0,title:'"level.js"'},'const Level = makeSprite({\n  init() {\n    return { playerX: 0 };\n  },\n\n  render({ updateState }) {\n    return [\n      Player({\n        id: "player",\n        increaseX: () => {\n          updateState((prevState) => ({\n            ...prevState,\n            playerX: prevState.playerX + 5,\n          }));\n        },\n      }),\n    ];\n  },\n});\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'{4} title="player.js"',"{4}":!0,title:'"player.js"'},"const Player = makeSprite({\n\n  loop({ props }) {\n    props.increaseX();\n  },\n\n});\n"))),Object(i.b)(o.a,{value:"ts",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts",metastring:'{10-14} title="level.ts"',"{10-14}":!0,title:'"level.ts"'},'const Level = makeSprite<{}, { playerX: number }>({\n  init() {\n    return { playerX: 0 };\n  },\n\n  render({ updateState }) {\n    return [\n      Player({\n        id: "player",\n        increaseX: () => {\n          updateState((prevState) => ({\n            ...prevState,\n            playerX: prevState.playerX + 5,\n          }));\n        },\n      }),\n    ];\n  },\n});\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts",metastring:'{4} title="player.ts"',"{4}":!0,title:'"player.ts"'},"const Player = makeSprite<{ increaseX: () => void }>({\n\n  loop({ props }) {\n    props.increaseX();\n  },\n\n});\n")))),Object(i.b)("p",null,"This is certainly more verbose than before, but it's arguably easier to understand how your code works since only ",Object(i.b)("inlineCode",{parentName:"p"},"Level")," is able to directly change its own state - it manages how its state changes through callbacks."),Object(i.b)("p",null,"This single way of building your game helps to keep game architecture both modular and consistent as your project scales in size."))}b.isMDXComponent=!0},158:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),p=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,d=u["".concat(l,".").concat(m)]||u[m]||b[m]||i;return n?r.a.createElement(d,o(o({ref:t},c),{},{components:n})):r.a.createElement(d,o({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var c=2;c<i;c++)l[c]=n[c];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},164:function(e,t,n){"use strict";var a=n(0),r=n.n(a),i=n(174),l=n(166),o=n(57),s=n.n(o),c=37,p=39;t.a=function(e){var t=e.lazy,n=e.block,o=e.defaultValue,u=e.values,b=e.groupId,m=e.className,d=Object(i.a)(),h=d.tabGroupChoices,f=d.setTabGroupChoices,y=Object(a.useState)(o),g=y[0],v=y[1],j=a.Children.toArray(e.children);if(null!=b){var O=h[b];null!=O&&O!==g&&u.some((function(e){return e.value===O}))&&v(O)}var w=function(e){v(e),null!=b&&f(b,e)},k=[];return r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(l.a)("tabs",{"tabs--block":n},m)},u.map((function(e){var t=e.value,n=e.label;return r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":g===t,className:Object(l.a)("tabs__item",s.a.tabItem,{"tabs__item--active":g===t}),key:t,ref:function(e){return k.push(e)},onKeyDown:function(e){!function(e,t,n){switch(n.keyCode){case p:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case c:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(k,e.target,e)},onFocus:function(){return w(t)},onClick:function(){w(t)}},n)}))),t?Object(a.cloneElement)(j.filter((function(e){return e.props.value===g}))[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},j.map((function(e,t){return Object(a.cloneElement)(e,{key:t,hidden:e.props.value!==g})}))))}},165:function(e,t,n){"use strict";var a=n(0),r=n.n(a);t.a=function(e){var t=e.children,n=e.hidden,a=e.className;return r.a.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},166:function(e,t,n){"use strict";function a(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(r&&(r+=" "),r+=t);return r}},174:function(e,t,n){"use strict";var a=n(0),r=n(175);t.a=function(){var e=Object(a.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},175:function(e,t,n){"use strict";var a=n(0),r=Object(a.createContext)(void 0);t.a=r},224:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/player-platform-25b34ef961345ffa9d8d7e48c83ed40e.png"},225:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/state-flow-489ca5bc77af476c84560b4bb6394200.png"}}]);